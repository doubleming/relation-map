(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();class Tt{constructor(t,s){this.bubbles=!1,this.type=t,s&&(this.target=s)}stopDefault(){this.isStopDefault=!0}stopNow(){this.isStopNow=!0,this.isStop=!0}stop(){this.isStop=!0}}class Et extends Tt{constructor(t,s,i){super(t,s),this.parent=i,this.child=s}}Et.ADD="child.add",Et.REMOVE="child.remove";class Ne extends Tt{constructor(t,s,i,o,r){super(t,s),this.attrName=i,this.oldValue=o,this.newValue=r}}Ne.CHANGE="property.change";class ne extends Tt{constructor(t,s,i,o,r,n){super(t,s),this.image=i,this.attrName=o,this.attrValue=r,n&&(this.error=n)}}ne.LOADED="image.loaded",ne.ERROR="image.error";class ce extends Tt{get bigger(){if(!this.old)return!0;const{width:t,height:s}=this.old;return this.width>=t&&this.height>=s}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,s){const i=typeof t=="object";super(i?ce.RESIZE:t),i&&Object.assign(this,t),this.old=s}}ce.RESIZE="resize";class _e extends Tt{constructor(t,s){super(t),s&&Object.assign(this,s)}}_e.START="transform.start",_e.CHANGE="transform.change",_e.END="transform.end",_e.BEFORE_START="transform.before_start",_e.BEFORE_CHANGE="transform.before_change",_e.BEFORE_END="transform.before_end";class he extends Tt{constructor(t,s){super(t),this.data=s}}he.REQUEST="watch.request",he.DATA="watch.data";class I extends Tt{constructor(t,s,i){super(t),s&&(this.data=s,this.times=i)}}I.CHECK_UPDATE="layout.check_update",I.REQUEST="layout.request",I.START="layout.start",I.BEFORE="layout.before",I.LAYOUT="layout.layout",I.AFTER="layout.after",I.AGAIN="layout.again",I.END="layout.end";class K extends Tt{constructor(t,s,i,o){super(t),s&&(this.times=s),i&&(this.renderBounds=i,this.renderOptions=o)}}K.REQUEST="render.request",K.START="render.start",K.BEFORE="render.before",K.RENDER="render",K.AFTER="render.after",K.AGAIN="render.again",K.END="render.end";class q extends Tt{}q.START="leafer.start",q.BEFORE_READY="leafer.before_ready",q.READY="leafer.ready",q.AFTER_READY="leafer.after_ready",q.VIEW_READY="leafer.view_ready",q.STOP="leafer.stop",q.RESTART="leafer.restart",q.END="leafer.end";class st{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.pushList(t):this.push(t))}has(t){return this.keys[t.innerId]!==void 0}indexAt(t){return this.list[t]}indexOf(t){const s=this.keys[t.innerId];return s===void 0?-1:s}pushList(t){t.forEach(s=>{this.push(s)})}unshift(t){const{keys:s}=this;s[t.innerId]===void 0&&(this.list.unshift(t),Object.keys(s).forEach(i=>{s[i]!==void 0&&s[i]++}),s[t.innerId]=0)}push(t){const{list:s,keys:i}=this;i[t.innerId]===void 0&&(s.push(t),i[t.innerId]=s.length-1)}sort(t){const{list:s}=this;t?s.sort((i,o)=>o.__level-i.__level):s.sort((i,o)=>i.__level-o.__level)}remove(t){const{list:s}=this;let i;for(let o=0,r=s.length;o<r;o++)i!==void 0?this.keys[s[o].innerId]=o-1:s[o].innerId===t.innerId&&(i=o,delete this.keys[t.innerId]);i!==void 0&&s.splice(i,1)}forEach(t){this.list.forEach(t)}clone(){const t=new st;return this.list.forEach(s=>{t.push(s)}),t}reset(){this.list=[],this.keys={}}destroy(){this.list=null}}class yr{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.pushList(t):this.push(t))}has(t){return this.keys[t.innerId]!==void 0}without(t){return this.keys[t.innerId]===void 0}sort(t){const{levels:s}=this;t?s.sort((i,o)=>o-i):s.sort((i,o)=>i-o)}pushList(t){t.forEach(s=>{this.push(s)})}push(t){const{keys:s,levelMap:i}=this;s[t.innerId]||(s[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let s;this.levels.forEach(i=>{s=this.levelMap[i];for(let o=0,r=s.length;o<r;o++)t(s[o])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const Qt={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",types:{},create(e){const{types:t}=on;return t[e]?t[e]++:(t[e]=1,0)}},on=Qt,Fe={within:(e,t,s)=>(e<t&&(e=t),e>s&&(e=s),e),fourNumber(e){let t,s,i,o;if(e instanceof Array)switch(e.length){case 4:return e;case 2:t=i=e[0],s=o=e[1];break;case 3:t=e[0],s=o=e[1],i=e[2];break;case 1:e=e[0];break;default:e=0}return t===void 0?[e,e,e,e]:[t,s,i,o]}},M=Math.PI/180,vt=2*Math.PI,Le=Math.PI/2,{sin:rn,cos:nn,acos:ps,atan:Zi,sqrt:Ji,PI:an}=Math,Be={};function hn(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const O={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},tempMatrix:{},set(e,t=1,s=0,i=0,o=1,r=0,n=0){e.a=t,e.b=s,e.c=i,e.d=o,e.e=r,e.f=n},get:hn,copy(e,t){e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f},translate(e,t,s){e.e+=t,e.f+=s},translateInner(e,t,s){e.e+=e.a*t+e.c*s,e.f+=e.b*t+e.d*s},scale(e,t,s=t){e.a*=t,e.d*=s,e.c*=t,e.b*=s},scaleOf(e,t,s,i=s){G.toInnerPoint(e,t,Be),G.scaleOfInner(e,Be,s,i)},scaleOfInner(e,t,s,i=s){G.translateInner(e,t.x,t.y),G.scale(e,s,i),G.translateInner(e,-t.x,-t.y)},rotate(e,t){const s=nn(t*=M),i=rn(t),{a:o,b:r,c:n,d:a}=e;e.a=o*s-r*i,e.b=o*i+r*s,e.c=n*s-a*i,e.d=n*i+a*s},rotateOf(e,t,s){G.toInnerPoint(e,t,Be),G.rotateOfInner(e,Be,s)},rotateOfInner(e,t,s){G.translateInner(e,t.x,t.y),G.rotate(e,s),G.translateInner(e,-t.x,-t.y)},skew(e,t,s){const{a:i,b:o,c:r,d:n}=e;s&&(s*=M,e.a=i+r*s,e.b=o+n*s),t&&(t*=M,e.c=r+i*t,e.d=n+o*t)},skewOf(e,t,s,i){G.toInnerPoint(e,t,Be),G.skewOfInner(e,Be,s,i)},skewOfInner(e,t,s,i){G.translateInner(e,t.x,t.y),G.skew(e,s,i),G.translateInner(e,-t.x,-t.y)},multiply(e,t){const{a:s,b:i,c:o,d:r,e:n,f:a}=e;e.a=t.a*s+t.b*o,e.b=t.a*i+t.b*r,e.c=t.c*s+t.d*o,e.d=t.c*i+t.d*r,e.e=t.e*s+t.f*o+n,e.f=t.e*i+t.f*r+a},preMultiply(e,t){const{a:s,b:i,c:o,d:r,e:n,f:a}=e;t.a===1&&t.b===0&&t.c===0&&t.d===1||(e.a=s*t.a+i*t.c,e.b=s*t.b+i*t.d,e.c=o*t.a+r*t.c,e.d=o*t.b+r*t.d),e.e=n*t.a+a*t.c+t.e,e.f=n*t.b+a*t.d+t.f},divide(e,t){G.multiply(e,G.tempInvert(t))},tempInvert(e){const{tempMatrix:t}=G;return G.copy(t,e),G.invert(t),t},invert(e){const{a:t,b:s,c:i,d:o,e:r,f:n}=e,a=1/(t*o-s*i);e.a=o*a,e.b=-s*a,e.c=-i*a,e.d=t*a,e.e=-(r*o-n*i)*a,e.f=-(n*t-r*s)*a},toOuterPoint(e,t,s,i){const{x:o,y:r}=t;s||(s=t),s.x=o*e.a+r*e.c,s.y=o*e.b+r*e.d,i||(s.x+=e.e,s.y+=e.f)},toInnerPoint(e,t,s,i){const{x:o,y:r}=t,{a:n,b:a,c:l,d:c}=e,u=1/(n*c-a*l);if(s||(s=t),s.x=(o*c-r*l)*u,s.y=(r*n-o*a)*u,!i){const{e:h,f:_}=e;s.x-=(h*c-_*l)*u,s.y-=(_*n-h*a)*u}},decompose(e){const{a:t,b:s,c:i,d:o}=e;let r=t,n=o,a=0,l=0,c=0;if(s||i){const u=t*o-s*i,h=t*i+s*o;if(s){const _=t*t+s*s;r=Ji(_),n=u/r;const p=t/r;a=s>0?ps(p):-ps(p),l=Zi(h/_)/M}else{const _=i*i+o*o;n=Ji(_),r=u/n;const p=i/n;a=an/2-(o>0?ps(-p):-ps(p)),c=Zi(h/_)/M}a/=M}return{x:e.e,y:e.f,scaleX:r,scaleY:n,rotation:a,skewX:l,skewY:c}},reset(e){G.set(e)}},G=O,{toInnerPoint:Us,toOuterPoint:ln}=O,{sin:to,cos:eo,abs:so,sqrt:dn,atan2:cn}=Math,L={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(e,t=0,s=0){e.x=t,e.y=s},copy(e,t){e.x=t.x,e.y=t.y},rotate(e,t,s){s||(s=Wt.defaultPoint);const i=eo(t*M),o=to(t*M),r=e.x-s.x,n=e.y-s.y;e.x=s.x+r*i-n*o,e.y=s.y+r*o-n*i},tempToInnerOf(e,t){const{tempPoint:s}=Wt;return Wt.copy(s,e),Us(t,s,s),s},tempToInnerRadiusPointOf(e,t){const{tempRadiusPoint:s}=Wt;return Wt.copy(s,e),Wt.toInnerRadiusPointOf(e,t,s),s},toInnerRadiusPointOf(e,t,s){s||(s=e),Us(t,e,s),s.radiusX=e.radiusX/t.a,s.radiusY=e.radiusY/t.d},toInnerOf(e,t,s){Us(t,e,s)},toOuterOf(e,t,s){ln(t,e,s)},getCenter:(e,t)=>({x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}),getDistance(e,t){const s=so(t.x-e.x),i=so(t.y-e.y);return dn(s*s+i*i)},getAngle:(e,t)=>Wt.getAtan2(e,t)/M,getAtan2:(e,t)=>cn(t.y-e.y,t.x-e.x),getDistancePoint(e,t,s){const i=Wt.getAtan2(e,t);return{x:e.x+eo(i)*s,y:e.y+to(i)*s}},reset(e){Wt.reset(e)}},Wt=L;class Ai{constructor(t,s){typeof t=="object"?L.copy(this,t):L.set(this,t,s)}set(t,s){L.set(this,t,s)}copy(t){return L.copy(this,t),this}clone(){return new Ai(this)}rotate(t,s){return L.rotate(this,t,s),this}toInnerOf(t,s){return L.toInnerOf(this,t,s),this}toOuterOf(t,s){return L.toOuterOf(this,t,s),this}getCenter(t){return L.getCenter(this,t)}getDistance(t){return L.getDistance(this,t)}getAngle(t){return L.getAngle(this,t)}getAtan2(t){return L.getAtan2(this,t)}reset(){L.reset(this)}}class le{constructor(t,s,i,o,r,n){typeof t=="object"?O.copy(this,t):O.set(this,t,s,i,o,r,n)}set(t,s,i,o,r,n){O.set(this,t,s,i,o,r,n)}copy(t){return O.copy(this,t),this}clone(){return new le(this)}translate(t,s){return O.translate(this,t,s),this}translateInner(t,s){return O.translateInner(this,t,s),this}scale(t,s){return O.scale(this,t,s),this}scaleOf(t,s,i){return O.scaleOf(this,t,s,i),this}scaleOfInner(t,s,i){return O.scaleOfInner(this,t,s,i),this}rotate(t){return O.rotate(this,t),this}rotateOf(t,s){return O.rotateOf(this,t,s),this}rotateOfInner(t,s){return O.rotateOfInner(this,t,s),this}skew(t,s){return O.skew(this,t,s),this}skewOf(t,s,i){return O.skewOf(this,t,s,i),this}skewOfInner(t,s,i){return O.skewOfInner(this,t,s,i),this}multiply(t){return O.multiply(this,t),this}preMultiply(t){return O.preMultiply(this,t),this}divide(t){return O.divide(this,t),this}invert(){return O.invert(this),this}toOuterPoint(t,s){O.toOuterPoint(this,t,s)}toInnerPoint(t,s){O.toInnerPoint(this,t,s)}decompose(){return O.decompose(this)}reset(){O.reset(this)}}const Mt={tempPointBounds:{},setPoint(e,t,s){e.minX=e.maxX=t,e.minY=e.maxY=s},addPoint(e,t,s){e.minX=t<e.minX?t:e.minX,e.minY=s<e.minY?s:e.minY,e.maxX=t>e.maxX?t:e.maxX,e.maxY=s>e.maxY?s:e.maxY},addBounds(e,t,s,i,o){io(e,t,s),io(e,t+i,s+o)},copy(e,t){e.minX=t.minX,e.minY=t.minY,e.maxX=t.maxX,e.maxY=t.maxY},add(e,t){e.minX=t.minX<e.minX?t.minX:e.minX,e.minY=t.minY<e.minY?t.minY:e.minY,e.maxX=t.maxX>e.maxX?t.maxX:e.maxX,e.maxY=t.maxY>e.maxY?t.maxY:e.maxY},toBounds(e,t){t.x=e.minX,t.y=e.minY,t.width=e.maxX-e.minX,t.height=e.maxY-e.minY}},{addPoint:io}=Mt,{tempPointBounds:te,setPoint:oo,addPoint:_s,toBounds:ro}=Mt,{toOuterPoint:gs}=O;let kt,Rt,Ee,Ce;const Ft={},ft={},R={tempBounds:{},set(e,t=0,s=0,i=0,o=0){e.x=t,e.y=s,e.width=i,e.height=o},copy(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},copyAndSpread(e,t,s){j.set(e,t.x-s,t.y-s,t.width+2*s,t.height+2*s)},right:e=>e.x+e.width,bottom:e=>e.y+e.height,move(e,t,s){e.x+=t,e.y+=s},getByMove:(e,t,s)=>(e=Object.assign({},e),j.move(e,t,s),e),toOffsetOutBounds(e,t,s){t?no(t,e):t=e,s?(t.offsetX=-(j.right(s)-e.x),t.offsetY=-(j.bottom(s)-e.y)):(t.offsetX=e.x+e.width,t.offsetY=e.y+e.height),j.move(t,-t.offsetX,-t.offsetY)},scale(e,t){e.x*=t,e.y*=t,e.width*=t,e.height*=t},tempToOuterOf:(e,t)=>(j.copy(j.tempBounds,e),j.toOuterOf(j.tempBounds,t),j.tempBounds),getOuterOf:(e,t)=>(e=Object.assign({},e),j.toOuterOf(e,t),e),toOuterOf(e,t,s){s||(s=e),t.b===0&&t.c===0?(s.x=t.e+e.x*t.a,s.y=t.f+e.y*t.d,s.width=e.width*t.a,s.height=e.height*t.d):(Ft.x=e.x,Ft.y=e.y,gs(t,Ft,ft),oo(te,ft.x,ft.y),Ft.x=e.x+e.width,gs(t,Ft,ft),_s(te,ft.x,ft.y),Ft.y=e.y+e.height,gs(t,Ft,ft),_s(te,ft.x,ft.y),Ft.x=e.x,gs(t,Ft,ft),_s(te,ft.x,ft.y),ro(te,s))},getFitMatrix(e,t){const s=Math.min(1,Math.min(e.width/t.width,e.height/t.height));return new le(s,0,0,s,-t.x*s,-t.y*s)},getSpread(e,t){const s={};return j.copyAndSpread(s,e,t),s},spread(e,t){j.copyAndSpread(e,e,t)},ceil(e){e.x=Math.floor(e.x),e.y=Math.floor(e.y),e.width=Math.ceil(e.width),e.height=Math.ceil(e.height)},add(e,t){kt=e.x+e.width,Rt=e.y+e.height,Ee=t.x+t.width,Ce=t.y+t.height,kt=kt>Ee?kt:Ee,Rt=Rt>Ce?Rt:Ce,e.x=e.x<t.x?e.x:t.x,e.y=e.y<t.y?e.y:t.y,e.width=kt-e.x,e.height=Rt-e.y},addList(e,t){j.setByListWithHandle(e,t,void 0,!0)},setByList(e,t,s=!1){j.setByListWithHandle(e,t,void 0,s)},addListWithHandle(e,t,s){j.setByListWithHandle(e,t,s,!0)},setByListWithHandle(e,t,s,i=!1){let o,r=!0;for(let n=0,a=t.length;n<a;n++)o=s?s(t[n]):t[n],o&&(o.width||o.height)&&(r?(r=!1,i||no(e,o)):un(e,o));r&&j.reset(e)},setByPoints(e,t){t.forEach((s,i)=>{i===0?oo(te,s.x,s.y):_s(te,s.x,s.y)}),ro(te,e)},hitRadiusPoint:(e,t,s)=>(s&&(t=L.tempToInnerRadiusPointOf(t,s)),t.x>=e.x-t.radiusX&&t.x<=e.x+e.width+t.radiusX&&t.y>=e.y-t.radiusY&&t.y<=e.y+e.height+t.radiusY),hitPoint:(e,t,s)=>(s&&(t=L.tempToInnerOf(t,s)),t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height),hit:(e,t,s)=>(s&&(t=j.tempToOuterOf(t,s)),!(e.y+e.height<t.y||t.y+t.height<e.y||e.x+e.width<t.x||t.x+t.width<e.x)),includes:(e,t,s)=>(s&&(t=j.tempToOuterOf(t,s)),e.x<=t.x&&e.y<=t.y&&e.x+e.width>=t.x+t.width&&e.y+e.height>=t.y+t.height),getIntersectData(e,t,s){s&&(t=j.tempToOuterOf(t,s));let{x:i,y:o,width:r,height:n}=t;return kt=i+r,Rt=o+n,Ee=e.x+e.width,Ce=e.y+e.height,i=i>e.x?i:e.x,o=o>e.y?o:e.y,kt=kt<Ee?kt:Ee,Rt=Rt<Ce?Rt:Ce,r=kt-i,n=Rt-o,{x:i,y:o,width:r,height:n}},intersect(e,t,s){j.copy(e,j.getIntersectData(e,t,s))},isSame:(e,t)=>e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height,isEmpty:e=>e.x===0&&e.y===0&&e.width===0&&e.height===0,reset(e){j.set(e)}},j=R,{add:un,copy:no}=j;class tt{constructor(t,s,i,o){typeof t=="object"?R.copy(this,t):R.set(this,t,s,i,o)}set(t,s,i,o){R.set(this,t,s,i,o)}copy(t){return R.copy(this,t),this}clone(){return new tt(this)}scale(t){return R.scale(this,t),this}toOuterOf(t,s){return R.toOuterOf(this,t,s),this}getFitMatrix(t){return R.getFitMatrix(this,t)}spread(t){return R.spread(this,t),this}ceil(){return R.ceil(this),this}add(t){return R.add(this,t),this}addList(t){return R.setByList(this,t,!0),this}setByList(t,s){return R.setByList(this,t,s),this}addListWithHandle(t,s){return R.setByListWithHandle(this,t,s,!0),this}setByListWithHandle(t,s,i){return R.setByListWithHandle(this,t,s,i),this}setByPoints(t){return R.setByPoints(this,t),this}hitPoint(t,s){return R.hitPoint(this,t,s)}hitRadiusPoint(t,s){return R.hitRadiusPoint(this,t,s)}hit(t,s){return R.hit(this,t,s)}includes(t,s){return R.includes(this,t,s)}intersect(t,s){return R.intersect(this,t,s),this}getIntersect(t,s){return new tt(R.getIntersectData(this,t,s))}isSame(t){return R.isSame(this,t)}isEmpty(){return R.isEmpty(this)}reset(){R.reset(this)}}class mr{constructor(t,s,i,o,r,n){typeof t=="object"?this.copy(t):this.set(t,s,i,o,r,n)}set(t=0,s=0,i=0,o=0,r=0,n=0){this.top=t,this.right=s,this.bottom=i,this.left=o,this.width=r,this.height=n}copy(t){const{top:s,right:i,bottom:o,left:r,width:n,height:a}=t;this.set(s,i,o,r,n,a)}getBoundsFrom(t){const{top:s,right:i,bottom:o,left:r,width:n,height:a}=this;return new tt(r,s,n||t.width-r-i,a||t.height-s-o)}}class pn{constructor(t,s){Mt.setPoint(this,t,s)}addPoint(t,s){Mt.addPoint(this,t,s)}addBounds(t,s,i,o){Mt.addBounds(this,t,s,i,o)}add(t){Mt.add(this,t)}}const vr={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},me={updateAllWorldMatrix(e){if(e.__updateWorldMatrix(),e.isBranch){const{children:t}=e;for(let s=0,i=t.length;s<i;s++)_n(t[s])}},updateAllWorldOpacity(e){if(e.__updateWorldOpacity(),e.isBranch){const{children:t}=e;for(let s=0,i=t.length;s<i;s++)ao(t[s])}},updateAllChange(e){if(ao(e),e.__updateChange(),e.isBranch){const{children:t}=e;for(let s=0,i=t.length;s<i;s++)gn(t[s])}},move(e,t,s){const i={x:t,y:s};e.parent&&O.toInnerPoint(e.parent.__world,i,i,!0),wr.moveLocal(e,i.x,i.y)},moveLocal(e,t,s){e.x=e.__.x+t,e.y=e.__.y+s},zoomOf(e,t,s,i,o){const r=e.parent?L.tempToInnerOf(t,e.parent.__world):t;this.zoomOfLocal(e,r,s,i,o)},zoomOfLocal(e,t,s,i,o){i||(i=s),o||(o=e);const{x:r,y:n}=o.__,a=new le().translate(r,n).scaleOf(t,s,i);o.x=a.e,o.y=a.f,e.scaleX=e.__.scaleX*s,e.scaleY=e.__.scaleY*i},rotateOf(e,t,s,i){const o=e.parent?L.tempToInnerOf(t,e.parent.__world):t;this.rotateOfLocal(e,o,s,i)},rotateOfLocal(e,t,s,i){i||(i=e);const{x:o,y:r}=i.__,n=new le().translate(o,r).rotateOf(t,s);i.x=n.e,i.y=n.f,e.rotation=e.__.rotation+s},drop(e,t){const s={x:e.x,y:e.y};e.localToWorld(s),t.worldToInner(s),e.set(s),t.add(e)}},wr=me,{updateAllWorldMatrix:_n,updateAllWorldOpacity:ao,updateAllChange:gn}=wr,Ii={worldBounds:e=>e.__world,localBoxBounds:e=>e.__local,localEventBounds:e=>e.__layout.localStrokeBounds,localRenderBounds:e=>e.__layout.localRenderBounds,maskLocalBoxBounds:e=>e.isMask?e.__local:null,maskLocalEventBounds:e=>e.isMask?e.__layout.localStrokeBounds:null,maskLocalRenderBounds:e=>e.isMask?e.__layout.localRenderBounds:null},ns={sort:(e,t)=>e.__.zIndex===t.__.zIndex?e.__tempNumber-t.__tempNumber:e.__.zIndex-t.__.zIndex,pushAllChildBranch(e,t){if(e.__tempNumber=1,e.__.__childBranchNumber){const{children:s}=e;for(let i=0,o=s.length;i<o;i++)(e=s[i]).isBranch&&(e.__tempNumber=1,t.push(e),fn(e,t))}},pushAllParent(e,t){const{keys:s}=t;if(s)for(;e.parent&&s[e.parent.innerId]===void 0;)t.push(e.parent),e=e.parent;else for(;e.parent;)t.push(e.parent),e=e.parent},pushAllBranchStack(e,t){let s=t.length;const{children:i}=e;for(let o=0,r=i.length;o<r;o++)i[o].isBranch&&t.push(i[o]);for(let o=s,r=t.length;o<r;o++)yn(t[o],t)},updateWorldBoundsByBranchStack(e){let t;for(let s=e.length-1;s>-1;s--){t=e[s];for(let i=0,o=t.children.length;i<o;i++)t.children[i].__updateWorldBounds()}t.__updateWorldBounds()}},{pushAllChildBranch:fn,pushAllBranchStack:yn}=ns,Ni={run(e){for(let t=0,s=e.length;t<s;t++)e[t]();e.length=0}},et={default:(e,t)=>(Xs(t,e),Xs(e,t),e),assign(e,t){let s;Object.keys(t).forEach(i=>{var o;s=t[i],(s==null?void 0:s.constructor)===Object&&((o=e[i])===null||o===void 0?void 0:o.constructor)===Object?Xs(e[i],t[i]):e[i]=t[i]})},copyAttrs:(e,t,s)=>(s.forEach(i=>{t[i]!==void 0&&(e[i]=t[i])}),e),clone:e=>JSON.parse(JSON.stringify(e))},{assign:Xs}=et;class Wi{constructor(t){this.__leaf=t}__get(t){if(this.__input){const s=this.__input[t];return s===void 0?this[t]:s}return this[t]}__setInput(t,s){this.__input||(this.__input={}),this.__input[t]=s}__getInput(t){if(this.__input){const s=this.__input[t];return s===void 0?this["_"+t]:s}return this["_"+t]}__removeInput(t){this.__input&&this.__input[t]!==void 0&&(this.__input[t]=void 0)}__getInputData(){const t={},{__input:s}=this;let i,o;for(let r in this)i=r.substring(1),this[i]!==void 0&&(o=s?s[i]:void 0,t[i]=o===void 0?this[r]:o);return t}__setMiddle(t,s){this.__middle||(this.__middle={}),this.__middle[t]=s}__getMiddle(t){return this.__middle&&this.__middle[t]}destroy(){this.__leaf=null}}class F{constructor(t){this.name=t}static get(t){return new F(t)}static set filter(t){t?typeof t=="string"&&(t=[t]):t=[],this.filterList=t}static set exclude(t){t?typeof t=="string"&&(t=[t]):t=[],this.excludeList=t}log(...t){if(ze.enable){if(ze.filterList.length&&ze.filterList.every(s=>s!==this.name)||ze.excludeList.length&&ze.excludeList.some(s=>s===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}warn(...t){console.warn(this.name,...t)}error(...t){try{throw new Error}catch(s){console.error(this.name,...t,s)}}}F.filterList=[],F.excludeList=[];const ze=F,ho=F.get("RunTime");class nt{static start(t,s){const i=Qt.create(Qt.RUNTIME);return yt.currentId=yt.idMap[i]=s?performance.now():Date.now(),yt.currentName=yt.nameMap[i]=t,yt.nameToIdMap[t]=i,i}static end(t,s){const i=yt.idMap[t],o=yt.nameMap[t];yt.idMap[t]=yt.nameMap[t]=yt.nameToIdMap[o]=void 0,s?ho.log(o,performance.now()-i,"µs"):ho.log(o,Date.now()-i,"ms")}static endOfName(t,s){const i=yt.nameToIdMap[t];i!==void 0&&yt.end(i,s)}}nt.idMap={},nt.nameMap={},nt.nameToIdMap={};const yt=nt,{updateAllWorldMatrix:mn,updateAllWorldOpacity:vn}=me,{pushAllChildBranch:wn,pushAllParent:lo}=ns,{worldBounds:co}=Ii,{setByListWithHandle:uo}=R;class xn{constructor(t){this.updatedBounds=new tt,this.beforeBounds=new tt,this.afterBounds=new tt,t instanceof Array&&(t=new st(t)),this.updatedList=t}setBefore(){uo(this.beforeBounds,this.updatedList.list,co)}setAfter(){uo(this.afterBounds,this.updatedList.list,co),this.updatedBounds.setByList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.pushList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllWorldMatrix:bn,updateAllChange:Bn}=me,{pushAllBranchStack:En,updateWorldBoundsByBranchStack:Cn}=ns,Vs=F.get("Layouter");class as{constructor(t,s){this.totalTimes=0,this.config={},this.__levelList=new yr,this.target=t,s&&(this.config=et.default(s,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(I.START),this.layoutOnce(),t.emitEvent(new I(I.END,this.layoutedBlocks,this.times))}catch(s){Vs.error(s)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Vs.warn("layouting"):this.times>3?Vs.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(he.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(!((t=this.__updateList)===null||t===void 0)&&t.length))return;const s=nt.start("PartLayout"),{target:i,__updateList:o}=this,{BEFORE:r,LAYOUT:n,AFTER:a}=I,l=this.getBlocks(o);l.forEach(c=>{c.setBefore()}),i.emitEvent(new I(r,l,this.times)),o.sort(),function(c,u){let h;c.list.forEach(_=>{h=_.__layout,u.without(_)&&!h.useZoomProxy&&(h.matrixChanged?(mn(_),u.push(_),_.isBranch&&wn(_,u),lo(_,u)):h.boundsChanged&&(u.push(_),_.isBranch&&(_.__tempNumber=0),lo(_,u)))})}(o,this.__levelList),function(c){let u,h;c.sort(!0),c.levels.forEach(_=>{u=c.levelMap[_];for(let p=0,m=u.length;p<m;p++){if(h=u[p],h.isBranch&&h.__tempNumber)for(let g=0,v=h.children.length;g<v;g++)h.children[g].isBranch||h.children[g].__updateWorldBounds();h.__updateWorldBounds()}})}(this.__levelList),function(c){c.list.forEach(u=>{u.__layout.opacityChanged&&vn(u),u.__updateChange()})}(o),l.forEach(c=>c.setAfter()),i.emitEvent(new I(n,l,this.times)),i.emitEvent(new I(a,l,this.times)),this.addBlocks(l),this.__levelList.reset(),this.__updateList=null,nt.end(s)}fullLayout(){const t=nt.start("FullLayout"),{target:s}=this,{BEFORE:i,LAYOUT:o,AFTER:r}=I,n=this.getBlocks(new st(s));s.emitEvent(new I(i,n,this.times)),as.fullLayout(s),n.forEach(a=>{a.setAfter()}),s.emitEvent(new I(o,n,this.times)),s.emitEvent(new I(r,n,this.times)),this.addBlocks(n),nt.end(t)}static fullLayout(t){if(bn(t),t.isBranch){const s=[t];En(t,s),Cn(s)}else t.__updateWorldBounds();Bn(t)}createBlock(t){return new xn(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updateList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(I.REQUEST,this.layout,this),t.on_(I.AGAIN,this.layoutAgain,this),t.on_(he.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.config=null)}}const A={layout:as.fullLayout},Z={},Tn=F.get("UICreator"),Fs={list:{},register(e){const{__tag:t}=e.prototype;Gs[t]?Tn.error("repeat:",t):Gs[t]=e},get(e,t,s,i,o,r){const n=new Gs[e](t);return s!==void 0&&(n.x=s,i&&(n.y=i),o&&(n.width=o),r&&(n.height=r)),n}},{list:Gs}=Fs,kn=F.get("EventCreator"),hs={nameList:{},register(e){let t;Object.keys(e).forEach(s=>{t=e[s],typeof t=="string"&&(je[t]?kn.error("repeat: ",t):je[t]=e)})},changeName(e,t){const s=je[e];if(s){const i=Object.keys(s).find(o=>s[o]===e);i&&(s[i]=t,je[t]=s)}},get:(e,...t)=>new je[e](...t)},{nameList:je}=hs;class Fi{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let s;const{list:i}=this;for(let r=0,n=i.length;r<n;r++)if(s=i[r],s.recycled&&s.isSameSize(t))return s.recycled=!1,s.manager||(s.manager=this),s;const o=Z.canvas(t);return this.add(o),o}recycle(t){t.recycled||(t.clear(),t.recycled=!0)}clearRecycled(){let t;const s=[];for(let i=0,o=this.list.length;i<o;i++)t=this.list[i],t.recycled?t.destroy():s.push(t);this.list=s}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destory(){this.clear()}}class xr extends Fi{constructor(){super(...arguments),this.pathTypeList=new st,this.imageTypeList=new st}get(t){}getImageType(t,s){return this.imageTypeList.push(t),Z.hitCanvas(s)}getPathType(t){return this.pathTypeList.push(t),Z.hitCanvas()}clearImageType(){this.__clearLeafList(this.imageTypeList)}clearPathType(){this.__clearLeafList(this.pathTypeList)}__clearLeafList(t){t.forEach(s=>{s.__hitCanvas&&(s.__hitCanvas.destroy(),s.__hitCanvas=null)}),t.reset()}clear(){this.clearPathType(),this.clearImageType()}}function d(e,t,s,i){var o,r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(e,t,s,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n);return r>3&&n&&Object.defineProperty(t,s,n),n}function Rn(e,t,s,i){return new(s||(s=Promise))(function(o,r){function n(c){try{l(i.next(c))}catch(u){r(u)}}function a(c){try{l(i.throw(c))}catch(u){r(u)}}function l(c){var u;c.done?o(c.value):(u=c.value,u instanceof s?u:new s(function(h){h(u)})).then(n,a)}l((i=i.apply(e,t||[])).next())})}function z(e){return(t,s)=>{e||(e=s),Object.defineProperty(t,s,{get(){return this.context[e]},set(o){this.context[e]=o}})}}const br=[];function S(){return(e,t)=>{br.push(t)}}const Pn=[];let b=class{set blendMode(e){e==="normal"&&(e="source-over"),this.context.globalCompositeOperation=e}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(e){this.context.setLineDash(e||Pn)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let e;br.forEach(t=>{e=this.context[t],e&&(this[t]=e.bind(this.context))})}setTransform(e,t,s,i,o,r){}resetTransform(){}getTransform(){}save(){}restore(){}transform(e,t,s,i,o,r){}translate(e,t){}scale(e,t){}rotate(e){}fill(e,t){}stroke(e){}clip(e,t){}fillRect(e,t,s,i){}strokeRect(e,t,s,i){}clearRect(e,t,s,i){}drawImage(e,t,s,i,o,r,n,a,l){switch(arguments.length){case 9:if(t<0){const c=-t/i*a;i+=t,t=0,r+=c,a-=c}if(s<0){const c=-s/o*l;o+=s,s=0,n+=c,l-=c}this.context.drawImage(e,t,s,i,o,r,n,a,l);break;case 5:this.context.drawImage(e,t,s,i,o);break;case 3:this.context.drawImage(e,t,s)}}beginPath(){}moveTo(e,t){}lineTo(e,t){}bezierCurveTo(e,t,s,i,o,r){}quadraticCurveTo(e,t,s,i){}closePath(){}arc(e,t,s,i,o,r){}arcTo(e,t,s,i,o){}ellipse(e,t,s,i,o,r,n,a){}rect(e,t,s,i){}roundRect(e,t,s,i,o){}createConicGradient(e,t,s){}createLinearGradient(e,t,s,i){}createPattern(e,t){}createRadialGradient(e,t,s,i,o,r){}fillText(e,t,s,i){}measureText(e){}strokeText(e,t,s,i){}destroy(){this.context=null}};d([z("imageSmoothingEnabled")],b.prototype,"smooth",void 0),d([z("imageSmoothingQuality")],b.prototype,"smoothLevel",void 0),d([z("globalAlpha")],b.prototype,"opacity",void 0),d([z()],b.prototype,"fillStyle",void 0),d([z()],b.prototype,"strokeStyle",void 0),d([z("lineWidth")],b.prototype,"strokeWidth",void 0),d([z("lineCap")],b.prototype,"strokeCap",void 0),d([z("lineJoin")],b.prototype,"strokeJoin",void 0),d([z("lineDashOffset")],b.prototype,"dashOffset",void 0),d([z()],b.prototype,"miterLimit",void 0),d([z()],b.prototype,"shadowBlur",void 0),d([z()],b.prototype,"shadowColor",void 0),d([z()],b.prototype,"shadowOffsetX",void 0),d([z()],b.prototype,"shadowOffsetY",void 0),d([z()],b.prototype,"filter",void 0),d([z()],b.prototype,"font",void 0),d([z()],b.prototype,"fontKerning",void 0),d([z()],b.prototype,"fontStretch",void 0),d([z()],b.prototype,"fontVariantCaps",void 0),d([z()],b.prototype,"textAlign",void 0),d([z()],b.prototype,"textBaseline",void 0),d([z()],b.prototype,"textRendering",void 0),d([z()],b.prototype,"wordSpacing",void 0),d([z()],b.prototype,"letterSpacing",void 0),d([z()],b.prototype,"direction",void 0),d([S()],b.prototype,"setTransform",null),d([S()],b.prototype,"resetTransform",null),d([S()],b.prototype,"getTransform",null),d([S()],b.prototype,"save",null),d([S()],b.prototype,"restore",null),d([S()],b.prototype,"transform",null),d([S()],b.prototype,"translate",null),d([S()],b.prototype,"scale",null),d([S()],b.prototype,"rotate",null),d([S()],b.prototype,"fill",null),d([S()],b.prototype,"stroke",null),d([S()],b.prototype,"clip",null),d([S()],b.prototype,"fillRect",null),d([S()],b.prototype,"strokeRect",null),d([S()],b.prototype,"clearRect",null),d([S()],b.prototype,"beginPath",null),d([S()],b.prototype,"moveTo",null),d([S()],b.prototype,"lineTo",null),d([S()],b.prototype,"bezierCurveTo",null),d([S()],b.prototype,"quadraticCurveTo",null),d([S()],b.prototype,"closePath",null),d([S()],b.prototype,"arc",null),d([S()],b.prototype,"arcTo",null),d([S()],b.prototype,"ellipse",null),d([S()],b.prototype,"rect",null),d([S()],b.prototype,"roundRect",null),d([S()],b.prototype,"createConicGradient",null),d([S()],b.prototype,"createLinearGradient",null),d([S()],b.prototype,"createPattern",null),d([S()],b.prototype,"createRadialGradient",null),d([S()],b.prototype,"fillText",null),d([S()],b.prototype,"measureText",null),d([S()],b.prototype,"strokeText",null);const X=new tt,On={width:1,height:1,pixelRatio:1},Lt=["width","height","pixelRatio"];class Br extends b{get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView&&!this.offscreen}constructor(t,s){super(),this.worldTransform={},t||(t=On),t.pixelRatio||(t.pixelRatio=A.devicePixelRatio),this.manager=s,this.innerId=Qt.create(Qt.CNAVAS);const{width:i,height:o,pixelRatio:r}=t;this.autoLayout=!i||!o,this.pixelRatio=r,this.offscreen=A.isWorker||t.offscreen,this.config=t,this.init(),this.textBaseline="alphabetic"}init(){}setBackgroundColor(t){}setHittable(t){}resize(t){if(this.isSameSize(t))return;const{width:s,height:i}=t;let o;this.context&&!this.unreal&&this.width&&(o=this.getSameCanvas(),o.copyWorld(this)),et.copyAttrs(this,t,Lt),this.bounds=new tt(0,0,s,i),this.unreal||(this.setViewSize(t),this.smooth=this.config.smooth),this.context&&!this.unreal&&o&&(this.clearWorld(o.bounds),this.copyWorld(o),o.recycle())}setViewSize(t){}startAutoLayout(t,s){}stopAutoLayout(){}setWorld(t,s,i){const{pixelRatio:o}=this,r=this.worldTransform;if(s)if(i)this.setTransform(r.a=t.a*o,r.b=t.b*o,r.c=t.c*o,r.d=t.d*o,r.e=(t.e+s.e)*o,r.f=(t.f+s.f)*o);else{const{a:n,b:a,c:l,d:c,e:u,f:h}=s;this.setTransform(r.a=(t.a*n+t.b*l)*o,r.b=(t.a*a+t.b*c)*o,r.c=(t.c*n+t.d*l)*o,r.d=(t.c*a+t.d*c)*o,r.e=(t.e*n+t.f*l+u)*o,r.f=(t.e*a+t.f*c+h)*o)}else this.setTransform(r.a=t.a*o,r.b=t.b*o,r.c=t.c*o,r.d=t.d*o,r.e=t.e*o,r.f=t.f*o)}setStroke(t,s,i){s&&(this.strokeWidth=s),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i)}setStrokeOptions(t){this.strokeCap=t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,s){return this.context.isPointInPath(t.x,t.y,s)}hitStroke(t,s){return this.strokeWidth=s,this.context.isPointInStroke(t.x,t.y)}setWorldShadow(t,s,i,o){const{pixelRatio:r}=this;this.shadowOffsetX=t*r,this.shadowOffsetY=s*r,this.shadowBlur=i*r,this.shadowColor=o||"black"}setWorldBlur(t){const{pixelRatio:s}=this;this.filter=`blur(${t*s}px)`}copyWorld(t,s,i,o){if(o&&(this.blendMode=o),s){const{pixelRatio:r}=this;i||(i=s),this.drawImage(t.view,s.x*r,s.y*r,s.width*r,s.height*r,i.x*r,i.y*r,i.width*r,i.height*r)}else this.drawImage(t.view,0,0);o&&(this.blendMode="source-over")}copyWorldToInner(t,s,i,o){if(o&&(this.blendMode=o),s.b||s.c)this.save(),this.resetTransform(),this.copyWorld(t,s,R.tempToOuterOf(i,s)),this.restore();else{const{pixelRatio:r}=this;this.drawImage(t.view,s.x*r,s.y*r,s.width*r,s.height*r,i.x,i.y,i.width,i.height)}o&&(this.blendMode="source-over")}useMask(t,s,i){this.copyWorld(t,s,i,"destination-in")}fillWorld(t,s,i){i&&(this.blendMode=i),this.fillStyle=s,X.copy(t).scale(this.pixelRatio),this.fillRect(X.x,X.y,X.width,X.height),i&&(this.blendMode="source-over")}strokeWorld(t,s,i){i&&(this.blendMode=i),this.strokeStyle=s,X.copy(t).scale(this.pixelRatio),this.strokeRect(X.x,X.y,X.width,X.height),i&&(this.blendMode="source-over")}clearWorld(t,s){X.copy(t).scale(this.pixelRatio),s&&X.ceil(),this.clearRect(X.x,X.y,X.width,X.height)}clipWorld(t,s){this.beginPath(),X.copy(t).scale(this.pixelRatio),s&&X.ceil(),this.rect(X.x,X.y,X.width,X.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t,this.height*t)}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t){const{width:s,height:i,pixelRatio:o}=this,r={width:s,height:i,pixelRatio:o},n=this.manager?this.manager.get(r):Z.canvas(r);if(n.save(),t){const a=this.worldTransform;n.setTransform(a.a,a.b,a.c,a.d,a.e,a.f)}return n}getBiggerCanvas(t,s){let{width:i,height:o,pixelRatio:r}=this;t&&(i+=t),s&&(o+=s);const n={width:i,height:o,pixelRatio:r},a=this.manager?this.manager.get(n):Z.canvas(n);return a.save(),a}recycle(){this.restore(),this.manager?this.manager.recycle(this):this.destroy()}unrealCanvas(){}destroy(){this.manager=null,this.view=null,this.parentView=null,this.context=null,this.config=null}}function ls(e,t,s){Object.defineProperty(e,t,s)}function zi(e,t){return Object.getOwnPropertyDescriptor(e,t)}function Ln(e){return(t,s)=>{ls(t,s,{get(){return this.__getAttr(e)},set(i){this.__setAttr(e,i)}})}}function at(e,t,s,i){ls(e,t,Object.assign({get(){return this.__getAttr(t)},set(r){this.__setAttr(t,r)},configurable:!0,enumerable:!0},i||{})),Yi(e,t,s)}function Se(e){return(t,s)=>{at(t,s,e)}}function bi(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.positionChanged||this.__layout.positionChange()}})}}function Bi(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.scaleChanged||this.__layout.scaleChange()}})}}function Ts(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.rotationChanged||this.__layout.rotationChange()}})}}function Y(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.boxChanged||this.__layout.boxChange()}})}}const Ct=Y;function ds(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.strokeChanged||this.__layout.strokeChange()}})}}const Pt=ds;function ji(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.renderChanged||this.__layout.renderChange()}})}}function Ei(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.surfaceChanged||this.__layout.surfaceChange()}})}}function Ci(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.opacityChanged||this.__layout.opacityChange()}})}}function Er(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.parent?this.parent.__layout.childrenSortChanged=!0:this.waitParent(()=>{this.parent.__layout.childrenSortChanged=!0})}})}}function Cr(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.boxChanged||this.__layout.boxChange(),this.parent?this.parent.__updateMask(i):this.waitParent(()=>{this.parent.__updateMask(i)})}})}}function Ie(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),F.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}})}}function it(e){return(t,s)=>{ls(t,"__DataProcessor",{get:()=>e})}}function Sn(e){return(t,s)=>{ls(t,"__LayoutProcessor",{get:()=>e})}}function Mn(e,t,s){Yi(e.prototype,t,s)}function Yi(e,t,s){const i=e.__DataProcessor.prototype,o="_"+t,r=function(l){return"set"+l.charAt(0).toUpperCase()+l.slice(1)}(t),n={get(){const l=this[o];return l===void 0?s:l},set(l){this[o]=l},configurable:!0,enumerable:!0};s===void 0&&(n.get=function(){return this[o]});const a=zi(i,t);a&&a.set&&(n.set=a.set),i[r]&&(n.set=i[r],delete i[r]),Object.defineProperty(i,t,n)}const Dn=new F("rewrite"),ks=[],An=["destroy","constructor"];function bt(e){return(t,s)=>{ks.push({name:t.constructor.name+"."+s,run:()=>{t[s]=e}})}}function Hi(){return e=>{Tr()}}function Tr(e){ks.length&&(ks.forEach(t=>{e&&Dn.error(t.name,"需在Class上装饰@rewriteAble()"),t.run()}),ks.length=0)}function dt(e,t){return s=>{var i;(e.prototype?(i=e.prototype,Object.getOwnPropertyNames(i)):Object.keys(e)).forEach(o=>{An.includes(o)||t&&t.includes(o)||(e.prototype?zi(e.prototype,o).writable&&(s.prototype[o]=e.prototype[o]):s.prototype[o]=e[o])})}}function ot(){return e=>{Fs.register(e)}}function Zt(){return e=>{hs.register(e)}}setTimeout(()=>Tr(!0));const{toOuterOf:qs}=R;class In{constructor(t){this.leaf=t,this.renderBounds=this.strokeBounds=this.boxBounds={x:0,y:0,width:0,height:0},this.localRenderBounds=this.localStrokeBounds=t.__local,this.boxChange()}checkUpdate(){const{leafer:t}=this.leaf;if(t)t.ready?t.watcher.changed&&t.layouter.layout():(t.start(),t.layouter.layout());else{let s=this.leaf;for(;s.parent;)s=s.parent;A.layout(s)}}getTransform(t){return this.checkUpdate(),t==="world"?this.leaf.__world:this.leaf.__local}decomposeTransform(t){return this.checkUpdate(),O.decompose(t==="world"?this.leaf.__world:this.leaf.__local)}getBounds(t,s){if(this.checkUpdate(),s==="world")switch(t){case"render":return this.leaf.__world;case"content":if(this.contentBounds)return this.getWorldContentBounds();case"margin":case"box":return this.getWorldBoxBounds();case"margin":case"stroke":return this.getWorldStrokeBounds()}else if(s==="inner")switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"margin":case"box":return this.boxBounds;case"stroke":return this.strokeBounds}else switch(t){case"render":return this.localRenderBounds;case"margin":case"content":case"box":return this.leaf.__local;case"stroke":return this.localStrokeBounds}}getWorldContentBounds(){return this._worldContentBounds||(this._worldContentBounds={}),qs(this.contentBounds,this.leaf.__world,this._worldContentBounds),this._worldContentBounds}getWorldBoxBounds(){return this._worldBoxBounds||(this._worldBoxBounds={}),qs(this.boxBounds,this.leaf.__world,this._worldBoxBounds),this._worldBoxBounds}getWorldStrokeBounds(){return this._worldStrokeBounds||(this._worldStrokeBounds={}),qs(this.strokeBounds,this.leaf.__world,this._worldStrokeBounds),this._worldStrokeBounds}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this.strokeBounds=this.boxBounds,this.localStrokeBounds=this.leaf.__local,t&&this.spreadRenderCancel()}spreadRenderCancel(){this.renderBounds=this.strokeBounds,this.localRenderBounds=this.localStrokeBounds}spreadStroke(){const{x:t,y:s,width:i,height:o}=this.strokeBounds;this.strokeBounds={x:t,y:s,width:i,height:o},this.localStrokeBounds={x:t,y:s,width:i,height:o},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:s,width:i,height:o}=this.renderBounds;this.renderBounds={x:t,y:s,width:i,height:o},this.localRenderBounds={x:t,y:s,width:i,height:o}}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}positionChange(){this.positionChanged=!0,this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}destroy(){this.leaf=null}}const po={},kr={on(e,t,s){let i,o,r;if(s){const c=typeof s=="boolean";i=c?s:s.capture,o=!c&&s.once}const n=Ks(this,i,!0),a=typeof e=="string"?e.split(" "):e,l=o?{listener:t,once:o}:{listener:t};a.forEach(c=>{c&&(r=n[c],r?r.findIndex(u=>u.listener===t)===-1&&r.push(l):n[c]=[l])})},off(e,t,s){let i,o,r;s&&(i=typeof s=="boolean"?s:s.capture);const n=Ks(this,i);(typeof e=="string"?e.split(" "):e).forEach(a=>{a&&(o=n[a],o&&(r=o.findIndex(l=>l.listener===t),r>-1&&o.splice(r,1),o.length||delete n[a]))})},on_(e,t,s,i){return s&&(t=t.bind(s)),this.on(e,t,i),{type:e,listener:t,options:i}},off_(e){if(!e)return;const t=e instanceof Array?e:[e];t.forEach(s=>{this.off(s.type,s.listener,s.options)}),t.length=0},once(e,t,s){this.on(e,t,{once:!0,capture:s})},emit(e,t,s){const i=Ks(this,s)[e];if(i){let o;for(let r=0,n=i.length;r<n&&(o=i[r],o.listener(t),o.once&&(this.off(e,o.listener,s),r--,n--),!t||!t.isStopNow);r++);}},emitEvent(e,t){e.current=this,this.emit(e.type,e,t)},hasEvent(e,t){const{__bubbleMap:s,__captureMap:i}=this;return t===void 0?!!(i&&i[e]||s&&s[e]):!!(t?i&&i[e]:s&&s[e])}};function Ks(e,t,s){if(t){const{__captureMap:i}=e;return i||(s?e.__captureMap={}:po)}{const{__bubbleMap:i}=e;return i||(s?e.__bubbleMap={}:po)}}const Rr={__setAttr(e,t){if(this.leafer&&this.leafer.ready){this.__[e]=t;const{CHANGE:s}=Ne,i=new Ne(s,this,e,this.__.__get(e),t);this.hasEvent(s)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}else this.__[e]=t},__getAttr(e){return this.__.__get(e)}},{defaultMatrix:Nn}=O,{sin:_o,cos:go}=Math,Pr={__updateWorldMatrix(){const e=this.parent?this.parent.__world:Nn,t=this.__local,s=this.__world;this.__layout.matrixChanged&&this.__updateLocalMatrix(),this.__layout.affectScaleOrRotation?(s.a=t.a*e.a+t.b*e.c,s.b=t.a*e.b+t.b*e.d,s.c=t.c*e.a+t.d*e.c,s.d=t.c*e.b+t.d*e.d,s.e=t.e*e.a+t.f*e.c+e.e,s.f=t.e*e.b+t.f*e.d+e.f):(s.a=e.a,s.b=e.b,s.c=e.c,s.d=e.d,s.e=t.e*e.a+t.f*e.c+e.e,s.f=t.e*e.b+t.f*e.d+e.f)},__updateLocalMatrix(){const e=this.__local,t=this.__layout;if(t.affectScaleOrRotation){const{scaleX:s,scaleY:i}=this.__;if(t.affectRotation){if(t.scaleChanged||t.rotationChanged){let{rotation:o,skewX:r,skewY:n}=this.__;o||r||n?(o*=M,r&&(r*=M),n&&(n*=M),e.a=s*go(o+n),e.b=s*_o(o+n),e.c=i*-_o(o-r),e.d=i*go(o-r)):(e.a=s,e.b=0,e.c=0,e.d=i,t.affectRotation=!1),t.scaleChanged=!1,t.rotationChanged=!1}}else t.scaleChanged&&(e.a=s,e.d=i,t.scaleChanged=!1)}t.positionChanged&&(e.e=this.__.x,e.f=this.__.y,t.positionChanged=!1),this.__layout.matrixChanged=!1}},{toOuterOf:Ye,copyAndSpread:fo}=R,Or={__updateWorldBounds(){var e;if(this.__layout.boundsChanged){let t;const s=this.__layout;s.boxChanged&&(this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),s.boxChanged=!1,t=!0),s.localBoxChanged&&(this.__updateLocalBoxBounds(),s.localBoxChanged=!1,s.strokeSpread&&(s.strokeChanged=!0),s.renderSpread&&(s.renderChanged=!0),(e=this.parent)===null||e===void 0||e.__layout.boxChange()),s.strokeChanged&&(s.strokeSpread=this.__updateStrokeSpread(),s.strokeSpread?(s.strokeBounds===s.boxBounds&&s.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):s.spreadStrokeCancel(),s.strokeChanged=!1,s.renderSpread&&(s.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t||(t=!0)),s.renderChanged&&(s.renderSpread=this.__updateRenderSpread(),s.renderSpread?(s.renderBounds!==s.boxBounds&&s.renderBounds!==s.strokeBounds||s.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):s.spreadRenderCancel(),s.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),s.boundsChanged=!1,Ye(this.__layout.renderBounds,this.__world,this.__world),t&&this.__onUpdateSize()}else Ye(this.__layout.renderBounds,this.__world,this.__world)},__updateLocalBoxBounds(){Ye(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){Ye(this.__layout.strokeBounds,this.__local,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){Ye(this.__layout.renderBounds,this.__local,this.__layout.localRenderBounds)},__updateBoxBounds(){const e=this.__layout.boxBounds;e.x=0,e.y=0,e.width=this.__.width,e.height=this.__.height},__updateStrokeBounds(){fo(this.__layout.strokeBounds,this.__layout.boxBounds,this.__layout.strokeSpread)},__updateRenderBounds(){fo(this.__layout.renderBounds,this.__layout.strokeBounds,this.__layout.renderSpread)}},{toInnerRadiusPointOf:Wn}=L,yo={},Lr={__hitWorld(e){return this.__layout.hitCanvasChanged&&(this.__updateHitCanvas(),this.__layout.hitCanvasChanged=!1),Wn(e,this.__world,yo),this.__hit(yo)},__drawHitPath(e){this.__drawRenderPath(e)}},Sr={__render(e,t){this.__worldOpacity&&(e.setWorld(this.__world,t.matrix),e.opacity=this.__worldOpacity,this.__draw(e,t))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},Mr={__updateMask(e){this.__hasMask=!!e||this.children.some(t=>t.__.isMask)},__renderMask(e,t,s){t.resetTransform(),t.useMask(s),e.resetTransform(),e.copyWorld(t)},__removeMask(e){if(e)e.isMask=!1,this.remove(e);else{const{children:t}=this;for(let s=0,i=t.length;s<i;s++)(e=t[s]).isMask&&(this.__removeMask(e),i--,s--)}}},{LEAF:Fn,create:zn}=Qt;let os=class{get tag(){return this.__tag}set tag(e){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return Wi}get __LayoutProcessor(){return In}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.checkUpdate(),this.__worldOpacity}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return this.__hasMask&&this.__.hitChildren}constructor(e){this.innerId=zn(Fn),this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0},this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0},this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),e&&Object.assign(this,e)}waitParent(e){this.__parentWait?this.__parentWait.push(e):this.__parentWait=[e]}waitLeafer(e){this.__leaferWait?this.__leaferWait.push(e):this.__leaferWait=[e]}__bindLeafer(e){if(this.isLeafer&&(e=this),this.leafer=e,this.__level=this.parent?this.parent.__level+1:1,this.__leaferWait&&e&&Ni.run(this.__leaferWait),this.isBranch){const{children:t}=this;for(let s=0,i=t.length;s<i;s++)t[s].__bindLeafer(e)}}set(e){}get(e){}__setAttr(e,t){}__getAttr(e){}forceUpdate(e){e||(e="x");const t=this.__.__get(e);this.__[e]=t===null?0:null,this[e]=t}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateMask(){}__renderMask(e,t,s){}__removeMask(e){}getWorld(e){return this.__layout.decomposeTransform("world")[e]}getBounds(e,t="world"){return this.__layout.getBounds(e,t)}worldToLocal(e,t,s){this.parent?O.toInnerPoint(this.parent.worldTransform,e,t,s):t&&L.copy(t,e)}localToWorld(e,t,s){this.parent?O.toOuterPoint(this.parent.worldTransform,e,t,s):t&&L.copy(t,e)}worldToInner(e,t,s){O.toInnerPoint(this.worldTransform,e,t,s)}innerToWorld(e,t,s){O.toOuterPoint(this.worldTransform,e,t,s)}__hitWorld(e){return!0}__hit(e){return!0}__drawHitPath(e){}__updateHitCanvas(){}__render(e,t){}__drawFast(e,t){}__draw(e,t){}__renderShape(e,t){}__updateWorldOpacity(){}__updateChange(){}__drawPath(e){}__drawRenderPath(e){}__updatePath(){}__updateRenderPath(){}__updateSortChildren(){}add(e,t){}remove(e){this.parent&&this.parent.remove(this)}on(e,t,s){}off(e,t,s){}on_(e,t,s,i){}off_(e){}once(e,t,s){}emit(e,t,s){}emitEvent(e,t){}hasEvent(e,t){return!1}destroy(){this.__&&(this.__hitCanvas&&(this.__hitCanvas.destroy(),this.__hitCanvas=null),this.leafer=null,this.parent=null,this.__.destroy(),this.__layout.destroy(),this.__=null,this.__layout=null,this.__captureMap=null,this.__bubbleMap=null,this.children&&(this.children.forEach(e=>{e.destroy()}),this.children.length=0))}};os=d([dt(Rr),dt(Pr),dt(Or),dt(Lr),dt(kr),dt(Sr)],os);const{setByListWithHandle:$s}=R,{sort:jn}=ns,{localBoxBounds:Yn,localEventBounds:Hn,localRenderBounds:Un,maskLocalBoxBounds:Xn,maskLocalEventBounds:Vn,maskLocalRenderBounds:Gn}=Ii;let Os=class extends os{constructor(){super(),this.isBranch=!0,this.children=[]}__updateStrokeSpread(){const{children:e}=this;for(let t=0,s=e.length;t<s;t++)if(e[t].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:e}=this;for(let t=0,s=e.length;t<s;t++)if(e[t].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){$s(this.__layout.boxBounds,this.children,this.__hasMask?Xn:Yn)}__updateStrokeBounds(){$s(this.__layout.strokeBounds,this.children,this.__hasMask?Vn:Hn)}__updateRenderBounds(){$s(this.__layout.renderBounds,this.children,this.__hasMask?Gn:Un)}__updateChange(){const{__layout:e}=this;e.childrenSortChanged&&(this.__updateSortChildren(),e.childrenSortChanged=!1)}__updateSortChildren(){const{children:e}=this;if(e.length>1){for(let t=0,s=e.length;t<s;t++)e[t].__tempNumber=t;e.sort(jn)}}__render(e,t){if(this.__worldOpacity){let s;const{children:i}=this;if(this.__hasMask&&i.length>1){let o,r=e.getSameCanvas(),n=e.getSameCanvas();for(let a=0,l=i.length;a<l;a++)s=i[a],s.isMask?(o?(this.__renderMask(e,n,r),r.clear(),n.clear()):o=!0,s.__render(r,t)):s.__render(n,t);this.__renderMask(e,n,r),r.recycle(),n.recycle()}else{const{bounds:o,hideBounds:r}=t;for(let n=0,a=i.length;n<a;n++)s=i[n],o&&!o.hit(s.__world,t.matrix)||r&&r.includes(s.__world,t.matrix)||s.__render(e,t)}}}add(e,t){if(e.parent&&e.parent.remove(e),e.parent=this,t===void 0?this.children.push(e):this.children.splice(t,0,e),e.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),e.__layout.boundsChanged||e.__layout.positionChange(),e.__parentWait&&Ni.run(e.__parentWait),this.leafer&&(e.__bindLeafer(this.leafer),this.leafer.ready)){const{ADD:s}=Et,i=new Et(s,e,this);e.hasEvent(s)&&e.emitEvent(i),this.hasEvent(s)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}}remove(e){if(e){const t=this.children.indexOf(e);if(t>-1&&(this.children.splice(t,1),this.__hasMask&&this.__updateMask(),this.__layout.boxChange(),e.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),e.parent=null,this.leafer&&(e.__bindLeafer(null),this.leafer.ready))){const{REMOVE:s}=Et,i=new Et(s,e,this);e.hasEvent(s)&&e.emitEvent(i),this.hasEvent(s)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}}else super.remove()}};Os=d([dt(Mr)],Os);const fs={};class ve{static isHoldSpaceKey(){return ve.hasDownCode("Space")}static setDownCode(t){fs[t]||(fs[t]=!0)}static setUpCode(t){fs[t]=!1}static hasDownCode(t){return fs[t]}}class Kt{static left(t){return t.buttons===1}static right(t){return t.buttons===2}static middle(t){return t.buttons===4}}class cs extends Tt{get spaceKey(){return ve.isHoldSpaceKey()}get left(){return Kt.left(this)}get right(){return Kt.right(this)}get middle(){return Kt.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}static changeName(t,s){hs.changeName(t,s)}}let C=class extends cs{};C.POINTER="pointer",C.BEFORE_DOWN="pointer.before_down",C.BEFORE_MOVE="pointer.before_move",C.BEFORE_UP="pointer.before_up",C.DOWN="pointer.down",C.MOVE="pointer.move",C.UP="pointer.up",C.OVER="pointer.over",C.OUT="pointer.out",C.ENTER="pointer.enter",C.LEAVE="pointer.leave",C.TAP="tap",C.DOUBLE_TAP="double_tap",C.CLICK="click",C.DOUBLE_CLICK="double_click",C.LONG_PRESS="long_press",C.LONG_TAP="long_tap",C=d([Zt()],C);let V=class extends C{};var Ti;V.DRAG="drag",V.START="drag.start",V.END="drag.end",V.OVER="drag.over",V.OUT="drag.out",V.ENTER="drag.enter",V.LEAVE="drag.leave",V=d([Zt()],V);let $t=Ti=class extends C{static setList(e){Ti.dragList=e instanceof st?e:new st(e)}static setData(e){this.dragData=e}};$t.DROP="drop",$t=Ti=d([Zt()],$t);let gt=class extends V{};gt.MOVE="move",gt.START="move.start",gt.END="move.end",gt=d([Zt()],gt);let qt=class extends cs{};qt.ROTATE="rotate",qt.START="rotate.start",qt.END="rotate.end",qt=d([Zt()],qt);let wt=class extends V{};wt.SWIPE="swipe",wt.LEFT="swipe.left",wt.RIGHT="swipe.right",wt.UP="swipe.up",wt.DOWN="swipe.down",wt=d([Zt()],wt);let St=class extends cs{};St.ZOOM="zoom",St.START="zoom.start",St.END="zoom.end",St=d([Zt()],St);let Me=class extends cs{};Me.DOWN="key.down",Me.PRESS="key.press",Me.UP="key.up",Me=d([Zt()],Me);class ki{constructor(t){this.options=t}load(t,s){A.origin.loadImage(this.options.url).then(i=>{this.ready=!0,this.width=i.naturalWidth||i.width,this.height=i.naturalHeight||i.height,this.view=i,t&&t(this)}).catch(i=>{s&&s(i)})}getCanvas(t,s,i,o){t||(t=this.width),s||(s=this.height);const r=A.origin.createCanvas(t,s),n=r.getContext("2d");return i&&(n.globalAlpha=i),n.drawImage(this.view,0,0,t,s),r}destory(){this.view=null,this.options=null}}class Dr{constructor(t,s){this.map={},this.leafer=t}get(t){let s=this.map[t.url];return s||(s=Z.image(t),this.map[t.url]=s),s}destory(){this.leafer=null,this.map=null}}const Bt={creator:{},parse(e,t){},convertToCanvasData(e,t){}},Ar={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},ct=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Ar),Ir={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ui={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},qn=Object.assign(Object.assign({},Ui),Ar),Ls=ct,Xi={};for(let e in Ls)Xi[Ls[e]]=e;const Vi={};for(let e in Ls)Vi[Ls[e]]=Ir[e];const Gi={drawRoundRect(e,t,s,i,o,r){let[n,a,l,c]=Fe.fourNumber(r);const u=Math.min(i/2,o/2);n>u&&(n=u),a>u&&(a=u),l>u&&(l=u),c>u&&(c=u),n?e.moveTo(t+n,s):e.moveTo(t,s),a?e.arcTo(t+i,s,t+i,s+o,a):e.lineTo(t+i,s),l?e.arcTo(t+i,s+o,t,s+o,l):e.lineTo(t+i,s+o),c?e.arcTo(t,s+o,t,s,c):e.lineTo(t,s+o),n?e.arcTo(t,s,t+i,s,n):e.lineTo(t,s)}},{sin:Te,cos:He,atan2:mo,ceil:Kn,abs:Qs,PI:vo}=Math,{setPoint:Zs,addPoint:ys}=Mt,{set:ms}=L,Js={},we={rect(e,t,s,i,o){Bt.creator.path=e,Bt.creator.moveTo(t,s).lineTo(t+i,s).lineTo(t+i,s+o).lineTo(t,s+o).lineTo(t,s)},roundRect(e,t,s,i,o,r){Bt.creator.path=[],Gi.drawRoundRect(Bt.creator,t,s,i,o,r),e.push(...Bt.convertToCanvasData(Bt.creator.path,!0))},arcTo(e,t,s,i,o,r,n,a,l,c,u){const h=i-t,_=o-s,p=r-i,m=n-o;let g=mo(_,h),v=mo(m,p),f=v-g;if(f<0&&(f+=vt),f===vo||Qs(h+_)<1e-12||Qs(p+m)<1e-12)return e&&e.push(ct.L,i,o),l&&(Zs(l,t,s),ys(l,i,o)),u&&ms(u,t,s),void(c&&ms(c,i,o));const y=h*m-p*_<0,w=y?-1:1,x=a/He(f/2),B=i+x*He(g+f/2+Le*w),k=o+x*Te(g+f/2+Le*w);return g-=Le*w,v-=Le*w,bo(e,B,k,a,a,0,g/M,v/M,y,l,c,u)},arc:(e,t,s,i,o,r,n,a,l,c)=>bo(e,t,s,i,i,0,o,r,n,a,l,c),ellipse(e,t,s,i,o,r,n,a,l,c,u,h){const _=r*M,p=Te(_),m=He(_);let g=n*M,v=a*M;g>vo&&(g-=vt),v<0&&(v+=vt);let f=v-g;f<0?f+=vt:f>vt&&(f-=vt),l&&(f-=vt);const y=Kn(Qs(f/Le)),w=f/y,x=Te(w/4),B=8/3*x*x/Te(w/2);v=g+w;let k,P,T,D,N,H,U,Q,It=He(g),Nt=Te(g),be=T=m*i*It-p*o*Nt,js=D=p*i*It+m*o*Nt,Ys=t+T,Hs=s+D;e&&e.push(ct.L,Ys,Hs),c&&Zs(c,Ys,Hs),h&&ms(h,Ys,Hs);for(let Qi=0;Qi<y;Qi++)k=He(v),P=Te(v),T=m*i*k-p*o*P,D=p*i*k+m*o*P,N=t+be-B*(m*i*Nt+p*o*It),H=s+js-B*(p*i*Nt-m*o*It),U=t+T+B*(m*i*P+p*o*k),Q=s+D+B*(p*i*P-m*o*k),e&&e.push(ct.C,N,H,U,Q,t+T,s+D),c&&xo(t+be,s+js,N,H,U,Q,t+T,s+D,c,!0),be=T,js=D,It=k,Nt=P,g=v,v+=w;u&&ms(u,t+T,s+D)},quadraticCurveTo(e,t,s,i,o,r,n){e.push(ct.C,(t+2*i)/3,(s+2*o)/3,(r+2*i)/3,(n+2*o)/3,r,n)},toTwoPointBoundsByQuadraticCurve(e,t,s,i,o,r,n,a){xo(e,t,(e+2*s)/3,(t+2*i)/3,(o+2*s)/3,(r+2*i)/3,o,r,n,a)},toTwoPointBounds(e,t,s,i,o,r,n,a,l,c){const u=[];let h,_,p,m,g,v,f,y,w=e,x=s,B=o,k=n;for(let P=0;P<2;++P)if(P==1&&(w=t,x=i,B=r,k=a),h=-3*w+9*x-9*B+3*k,_=6*w-12*x+6*B,p=3*x-3*w,Math.abs(h)<1e-12){if(Math.abs(_)<1e-12)continue;m=-p/_,0<m&&m<1&&u.push(m)}else f=_*_-4*p*h,y=Math.sqrt(f),f<0||(g=(-_+y)/(2*h),0<g&&g<1&&u.push(g),v=(-_-y)/(2*h),0<v&&v<1&&u.push(v));c?ys(l,e,t):Zs(l,e,t),ys(l,n,a);for(let P=0,T=u.length;P<T;P++)wo(u[P],e,t,s,i,o,r,n,a,Js),ys(l,Js.x,Js.y)},getPointAndSet(e,t,s,i,o,r,n,a,l,c){const u=1-e,h=u*u*u,_=3*u*u*e,p=3*u*e*e,m=e*e*e;c.x=h*t+_*i+p*r+m*a,c.y=h*s+_*o+p*n+m*l},getPoint(e,t,s,i,o,r,n,a,l){const c={};return wo(e,t,s,i,o,r,n,a,l,c),c}},{getPointAndSet:wo,toTwoPointBounds:xo,ellipse:bo}=we,{sin:$n,cos:Qn,sqrt:Bo,atan2:Eo}=Math,{ellipse:Zn}=we,Nr={ellipticalArc(e,t,s,i,o,r,n,a,l,c,u){const h=(l-t)/2,_=(c-s)/2,p=r*M,m=$n(p),g=Qn(p),v=-g*h-m*_,f=-g*_+m*h,y=i*i,w=o*o,x=f*f,B=v*v,k=y*w-y*x-w*B;let P=0;if(k<0){const be=Bo(1-k/(y*w));i*=be,o*=be}else P=(n===a?-1:1)*Bo(k/(y*x+w*B));const T=P*i*f/o,D=-P*o*v/i,N=Eo((f-D)/o,(v-T)/i),H=Eo((-f-D)/o,(-v-T)/i);let U=H-N;a===0&&U>0?U-=vt:a===1&&U<0&&(U+=vt);const Q=t+h+g*T-m*D,It=s+_+m*T+g*D,Nt=U<0?1:0;u?Zn(e,Q,It,i,o,r,N/M,H/M,Nt):i!==o||r?e.push(ct.G,Q,It,i,o,r,N/M,H/M,Nt):e.push(ct.O,Q,It,i,N/M,H/M,Nt)}},{M:Co,m:Jn,L:vs,l:ta,H:ea,h:sa,V:ia,v:oa,C:Ue,c:ra,S:ti,s:na,Q:Xe,q:aa,T:ei,t:ha,A:la,a:da,Z:To,z:ca,N:ua,D:pa,X:_a,G:ga,F:fa,O:ya,P:ma,U:va}=ct,{rect:wa,roundRect:ko,arcTo:xa,arc:Ro,ellipse:Po,quadraticCurveTo:Oo}=we,{ellipticalArc:ba}=Nr,Ba=F.get("PathConvert"),zt={},de={current:{},stringify(e){let t,s,i,o=0,r=e.length,n="";for(;o<r;){s=e[o],t=Vi[s],n+=s===i?" ":Xi[s];for(let a=1;a<t;a++)n+=e[o+a],a===t-1||(n+=" ");i=s,o+=t}return n},parse(e,t){let s,i,o,r="";const n=[],a=t?qn:Ui;for(let l=0,c=e.length;l<c;l++)i=e[l],vr[i]?r+=i:ct[i]?(r&&(Ve(n,Number(r)),r=""),jt.name=ct[i],jt.length=Ir[i],jt.index=0,Ve(n,jt.name),!s&&a[i]&&(s=!0)):i==="-"||i==="+"?o==="e"||o==="E"?r+=i:(r&&Ve(n,Number(r)),r=i):r&&(Ve(n,Number(r)),r=""),o=i;return r&&Ve(n,Number(r)),s?de.toCanvasData(n,t):n},toCanvasData(e,t){let s,i,o,r,n,a=0,l=0,c=0,u=0,h=0,_=e.length;const p=[];for(;h<_;){switch(o=e[h],o){case Jn:e[h+1]+=a,e[h+2]+=l;case Co:a=e[h+1],l=e[h+2],p.push(Co,a,l),h+=3;break;case sa:e[h+1]+=a;case ea:a=e[h+1],p.push(vs,a,l),h+=2;break;case oa:e[h+1]+=l;case ia:l=e[h+1],p.push(vs,a,l),h+=2;break;case ta:e[h+1]+=a,e[h+2]+=l;case vs:a=e[h+1],l=e[h+2],p.push(vs,a,l),h+=3;break;case na:e[h+1]+=a,e[h+2]+=l,e[h+3]+=a,e[h+4]+=l,o=ti;case ti:n=r===Ue||r===ti,c=n?2*a-s:e[h+1],u=n?2*l-i:e[h+2],s=e[h+1],i=e[h+2],a=e[h+3],l=e[h+4],p.push(Ue,c,u,s,i,a,l),h+=5;break;case ra:e[h+1]+=a,e[h+2]+=l,e[h+3]+=a,e[h+4]+=l,e[h+5]+=a,e[h+6]+=l,o=Ue;case Ue:s=e[h+3],i=e[h+4],a=e[h+5],l=e[h+6],p.push(Ue,e[h+1],e[h+2],s,i,a,l),h+=7;break;case ha:e[h+1]+=a,e[h+2]+=l,o=ei;case ei:n=r===Xe||r===ei,s=n?2*a-s:e[h+1],i=n?2*l-i:e[h+2],t?Oo(p,a,l,s,i,e[h+1],e[h+2]):p.push(Xe,s,i,e[h+1],e[h+2]),a=e[h+1],l=e[h+2],h+=3;break;case aa:e[h+1]+=a,e[h+2]+=l,e[h+3]+=a,e[h+4]+=l,o=Xe;case Xe:s=e[h+1],i=e[h+2],t?Oo(p,a,l,s,i,e[h+3],e[h+4]):p.push(Xe,s,i,e[h+3],e[h+4]),a=e[h+3],l=e[h+4],h+=5;break;case da:e[h+6]+=a,e[h+7]+=l;case la:ba(p,a,l,e[h+1],e[h+2],e[h+3],e[h+4],e[h+5],e[h+6],e[h+7],t),a=e[h+6],l=e[h+7],h+=8;break;case ca:case To:p.push(To),h++;break;case ua:a=e[h+1],l=e[h+2],t?wa(p,a,l,e[h+3],e[h+4]):ee(p,e,h,5),h+=5;break;case pa:a=e[h+1],l=e[h+2],t?ko(p,a,l,e[h+3],e[h+4],[e[h+5],e[h+6],e[h+7],e[h+8]]):ee(p,e,h,9),h+=9;break;case _a:a=e[h+1],l=e[h+2],t?ko(p,a,l,e[h+3],e[h+4],e[h+5]):ee(p,e,h,6),h+=6;break;case ga:Po(t?p:ee(p,e,h,9),e[h+1],e[h+2],e[h+3],e[h+4],e[h+5],e[h+6],e[h+7],e[h+8],null,zt),a=zt.x,l=zt.y,h+=9;break;case fa:t?Po(p,e[h+1],e[h+2],e[h+3],e[h+4],0,0,360,!1):ee(p,e,h,5),a=e[h+1]+e[h+3],l=e[h+2],h+=5;break;case ya:Ro(t?p:ee(p,e,h,7),e[h+1],e[h+2],e[h+3],e[h+4],e[h+5],e[h+6],null,zt),a=zt.x,l=zt.y,h+=7;break;case ma:t?Ro(p,e[h+1],e[h+2],e[h+3],0,360,!1):ee(p,e,h,4),a=e[h+1]+e[h+3],l=e[h+2],h+=4;break;case va:xa(t?p:ee(p,e,h,6),a,l,e[h+1],e[h+2],e[h+3],e[h+4],e[h+5],null,zt),a=zt.x,l=zt.y,h+=6;break;default:return Ba.error(`command: ${o} [index:${h}]`,e),p}r=o}return p},copyData(e,t,s,i){for(let o=s,r=s+i;o<r;o++)e.push(t[o])},pushData(e,t){jt.index===jt.length&&(jt.index=1,e.push(jt.name)),e.push(t),jt.index++}},{current:jt,pushData:Ve,copyData:ee}=de,{M:si,L:Ea,C:Ca,Q:Ta,Z:ka,N:Lo,D:Ra,X:Pa,G:Oa,F:La,O:Sa,P:Ma,U:Da}=ct,ke={},xe={beginPath(e){e.length=0},moveTo(e,t,s){e.push(si,t,s)},lineTo(e,t,s){e.push(Ea,t,s)},bezierCurveTo(e,t,s,i,o,r,n){e.push(Ca,t,s,i,o,r,n)},quadraticCurveTo(e,t,s,i,o){e.push(Ta,t,s,i,o)},closePath(e){e.push(ka)},rect(e,t,s,i,o){e.push(Lo,t,s,i,o)},roundRect(e,t,s,i,o,r){if(typeof r=="number")e.push(Pa,t,s,i,o,r);else{const n=Fe.fourNumber(r);n?e.push(Ra,t,s,i,o,...n):e.push(Lo,t,s,i,o)}},ellipse(e,t,s,i,o,r,n,a,l){r===void 0?e.push(La,t,s,i,o):(n===void 0&&(n=0),a===void 0&&(a=360),e.push(Oa,t,s,i,o,r,n,a,l?1:0))},arc(e,t,s,i,o,r,n){o===void 0?e.push(Ma,t,s,i):(r===void 0&&(r=360),e.push(Sa,t,s,i,o,r,n?1:0))},moveToEllipse(e,t,s,i,o,r,n,a,l){r===void 0&&(r=0),n===void 0&&(n=0),a===void 0&&(a=360),we.ellipse(null,t,s,i,o,r,n,a,l,null,null,ke),e.push(si,ke.x,ke.y),Aa(e,t,s,i,o,r,n,a,l)},moveToArc(e,t,s,i,o,r,n){o===void 0&&(o=0),r===void 0&&(r=360),we.arc(null,t,s,i,o,r,n,null,null,ke),e.push(si,ke.x,ke.y),Ia(e,t,s,i,o,r,n)},arcTo(e,t,s,i,o,r){e.push(Da,t,s,i,o,r)}},{ellipse:Aa,arc:Ia}=xe,{moveTo:Na,lineTo:Wa,quadraticCurveTo:Fa,bezierCurveTo:za,closePath:ja,beginPath:Ya,rect:Ha,roundRect:Ua,ellipse:Xa,arc:Va,arcTo:Ga,moveToEllipse:qa,moveToArc:Ka}=xe;class qi{constructor(t){this.path=t?typeof t=="string"?Bt.parse(t):t:[]}beginPath(){return Ya(this.path),this}moveTo(t,s){return Na(this.path,t,s),this}lineTo(t,s){return Wa(this.path,t,s),this}bezierCurveTo(t,s,i,o,r,n){return za(this.path,t,s,i,o,r,n),this}quadraticCurveTo(t,s,i,o){return Fa(this.path,t,s,i,o),this}closePath(){return ja(this.path),this}rect(t,s,i,o){return Ha(this.path,t,s,i,o),this}roundRect(t,s,i,o,r){return Ua(this.path,t,s,i,o,r),this}ellipse(t,s,i,o,r,n,a,l){return Xa(this.path,t,s,i,o,r,n,a,l),this}arc(t,s,i,o,r,n){return Va(this.path,t,s,i,o,r,n),this}arcTo(t,s,i,o,r){return Ga(this.path,t,s,i,o,r),this}moveToEllipse(t,s,i,o,r,n,a,l){return qa(this.path,t,s,i,o,r,n,a,l),this}moveToArc(t,s,i,o,r,n){return Ka(this.path,t,s,i,o,r,n),this}}const{M:$a,L:Qa,C:Za,Q:Ja,Z:th,N:eh,D:sh,X:ih,G:oh,F:rh,O:nh,P:ah,U:hh}=ct,lh=F.get("PathDrawer"),Wr={drawPathByData(e,t){if(!t)return;let s,i=0,o=t.length;for(;i<o;)switch(s=t[i],s){case $a:e.moveTo(t[i+1],t[i+2]),i+=3;break;case Qa:e.lineTo(t[i+1],t[i+2]),i+=3;break;case Za:e.bezierCurveTo(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5],t[i+6]),i+=7;break;case Ja:e.quadraticCurveTo(t[i+1],t[i+2],t[i+3],t[i+4]),i+=5;break;case th:e.closePath(),i+=1;break;case eh:e.rect(t[i+1],t[i+2],t[i+3],t[i+4]),i+=5;break;case sh:e.roundRect(t[i+1],t[i+2],t[i+3],t[i+4],[t[i+5],t[i+6],t[i+7],t[i+8]]),i+=9;break;case ih:e.roundRect(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5]),i+=6;break;case oh:e.ellipse(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5]*M,t[i+6]*M,t[i+7]*M,t[i+8]),i+=9;break;case rh:e.ellipse(t[i+1],t[i+2],t[i+3],t[i+4],0,0,vt,!1),i+=5;break;case nh:e.arc(t[i+1],t[i+2],t[i+3],t[i+4]*M,t[i+5]*M,t[i+6]),i+=7;break;case ah:e.arc(t[i+1],t[i+2],t[i+3],0,vt,!1),i+=4;break;case hh:e.arcTo(t[i+1],t[i+2],t[i+3],t[i+4],t[i+5]),i+=6;break;default:return void lh.error(`command: ${s} [index:${i}]`,t)}}},{M:dh,L:ch,C:So,Q:Mo,Z:Do,N:uh,D:Ao,X:ph,G:_h,F:gh,O:fh,P:yh,U:mh}=ct,{toTwoPointBounds:vh,toTwoPointBoundsByQuadraticCurve:wh,arcTo:xh,arc:bh,ellipse:Bh}=we,{add:Ge,copy:ii,addPoint:Eh,setPoint:oi,addBounds:ws,toBounds:Ch}=Mt,Th=F.get("PathBounds");let Re,xs,ri;const ut={},Io={},Yt={},Ki={toBounds(e,t){Ki.toTwoPointBounds(e,Io),Ch(Io,t)},toTwoPointBounds(e,t){if(!e||!e.length)return oi(t,0,0);let s,i,o,r,n,a=0,l=0,c=0;const u=e.length;for(;a<u;)switch(s=e[a],a===0&&(s===Do||s===So||s===Mo?oi(t,l,c):oi(t,e[a+1],e[a+2])),s){case dh:case ch:l=e[a+1],c=e[a+2],Eh(t,l,c),a+=3;break;case So:r=e[a+5],n=e[a+6],vh(l,c,e[a+1],e[a+2],e[a+3],e[a+4],r,n,ut),Ge(t,ut),l=r,c=n,a+=7;break;case Mo:i=e[a+1],o=e[a+2],r=e[a+3],n=e[a+4],wh(l,c,i,o,r,n,ut),Ge(t,ut),l=r,c=n,a+=5;break;case Do:a+=1;break;case uh:l=e[a+1],c=e[a+2],ws(t,l,c,e[a+3],e[a+4]),a+=5;break;case Ao:case ph:l=e[a+1],c=e[a+2],ws(t,l,c,e[a+3],e[a+4]),a+=s===Ao?9:6;break;case _h:Bh(null,e[a+1],e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],e[a+7],e[a+8],ut,Yt),a===0?ii(t,ut):Ge(t,ut),l=Yt.x,c=Yt.y,a+=9;break;case gh:l=e[a+1],c=e[a+2],xs=e[a+3],ri=e[a+4],ws(t,l-xs,c-ri,2*xs,2*ri),l+=xs,a+=5;break;case fh:bh(null,e[a+1],e[a+2],e[a+3],e[a+4],e[a+5],e[a+6],ut,Yt),a===0?ii(t,ut):Ge(t,ut),l=Yt.x,c=Yt.y,a+=7;break;case yh:l=e[a+1],c=e[a+2],Re=e[a+3],ws(t,l-Re,c-Re,2*Re,2*Re),l+=Re,a+=4;break;case mh:xh(null,l,c,e[a+1],e[a+2],e[a+3],e[a+4],e[a+5],ut,Yt),a===0?ii(t,ut):Ge(t,ut),l=Yt.x,c=Yt.y,a+=6;break;default:return void Th.error(`command: ${s} [index:${a}]`,e)}}},Fr={smooth:(e,t,s)=>e};Bt.creator=new qi,Bt.parse=de.parse,Bt.convertToCanvasData=de.toCanvasData;const ni=F.get("plugin"),Ss={power:{},list:[]};function kh(e,t){t||(t=Ss.power),Ss.list.push(e);const s={};e.import?e.import.forEach(i=>{t[i]?s[i]=t[i]:ni.error(i+" non-existent")}):ni.warn("no import");try{e.run(s)}catch(i){ni.error(i)}}class Rs{constructor(t){this.taskTime=1,this.id=Qt.create(Qt.TASK),this.task=t}run(){return Rn(this,void 0,void 0,function*(){this.task&&!this.isComplete&&this.parent.running&&(yield this.task())})}complete(){this.isComplete=!0,this.parent=null,this.task=null}}const Rh=F.get("TaskProcessor");class Ph{get isComplete(){return this._isComplete}get running(){return this._running}constructor(t){this.parallel=6,this.params={},this.list=[],this.index=0,t&&(this.params=t,t.parallel&&(this.parallel=t.parallel)),this.init()}get percent(){const t=this.list.length;let s=0,i=0;for(let r=0;r<t;r++)r<=this.index?(i+=this.list[r].taskTime,r===this.index&&(s=i)):s+=this.list[r].taskTime;let o=this._isComplete?1:i/s;return Number.isNaN(o)&&(o=0),o}get total(){return this.list.length}get runIndex(){return this.index}init(){this.empty(),this.index=0,this.parallelSuccessNumber=0,this._running=!1,this._isComplete=!1}empty(){this.list=[],this.parallelList=[]}start(){this._running=!0,this._isComplete=!1,this.run()}pause(){this._running=!1}resume(){this._running=!0,this._isComplete=!1,this.run()}skip(){this.index++,this.resume()}stop(){this._running=!1,this.list.forEach(t=>{t.complete()}),this.empty()}add(t,s){this.push(new Rs(t),s)}addParallel(t,s){const i=new Rs(t);i.parallel=!0,this.push(i,s)}addEmpty(t){this.push(new Rs(t))}push(t,s){s&&(t.taskTime=s),t.parent=this,this.list.push(t)}run(){this._running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTask():this.runTask())}runTask(){const t=this.list[this.index];t.run().then(()=>{this.onTask(t),this.index++,this.nextTask()}).catch(s=>{this.onError(s)})}runParallelTask(){this.parallelList.forEach(t=>{t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(s=>{this.onParallelError(s)})})}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let s=this.index+this.parallel;s>this.list.length&&(s=this.list.length);for(let i=this.index;i<s&&(t=this.list[i],t.parallel);i++)this.parallelList.push(t)}fillParallelTask(){let t;const s=this.parallelList;this.parallelSuccessNumber++,s.pop();const i=s.length,o=this.index+this.parallelSuccessNumber+i;if(s.length){if(!this._running)return;o<this.list.length&&(t=this.list[o],t.parallel&&(s.push(t),t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(r=>{this.onParallelError(r)})))}else this.index+=this.parallelSuccessNumber,this.nextTask()}nextTask(){setTimeout(()=>{this.run()},0)}onComplete(){this.stop(),this._isComplete=!0,this.params.onComplete&&this.params.onComplete()}onTask(t){t.complete(),this.params.onTask&&this.params.onTask(),this.index===this.list.length-1&&this.onComplete()}onParallelError(t){Rh.error("ParallelError"),this.parallelList.forEach(s=>{s.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.params.onError&&this.params.onError(t)}}class zr{constructor(t,s){this.updatedList=new st,this.totalTimes=0,this.config={},this.target=t,s&&(this.config=et.default(s,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(K.REQUEST)}__onAttrChange(t){this.updatedList.push(t.target),this.update()}__onChildEvent(t){this.updatedList.push(t.type===Et.REMOVE?t.parent:t.child),this.update()}__onRquestData(){this.target.emitEvent(new he(he.DATA,{updatedList:this.updatedList})),this.updatedList=new st,this.totalTimes++,this.changed=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Ne.CHANGE,this.__onAttrChange,this),t.on_([Et.ADD,Et.REMOVE],this.__onChildEvent,this),t.on_(he.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.updatedList=null)}}const ue=F.get("Renderer");class jr{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,s,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=s,i&&(this.config=et.default(i,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed||this.__requestRender(),this.changed=!0}requestLayout(){this.target.emit(I.REQUEST)}render(t){if(!this.running)return;const{target:s}=this;this.times=0,this.totalBounds=new tt,ue.log(s.innerName,"--->");try{this.emitRender(K.START),this.renderOnce(t),this.emitRender(K.END,this.totalBounds)}catch(i){ue.error(i)}ue.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){return this.rendering?ue.warn("rendering"):this.times>3?ue.warn("render max times"):(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new tt,this.renderOptions={},t?(this.emitRender(K.BEFORE),t()):(this.requestLayout(),this.emitRender(K.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()),this.emitRender(K.RENDER,this.renderBounds,this.renderOptions),this.emitRender(K.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,void(this.waitAgain&&(this.waitAgain=!1,this.renderOnce())))}partRender(){const{canvas:t,updateBlocks:s}=this;if(!s)return ue.warn("PartRender: need update attr");s.some(i=>i.includes(this.target.__world))&&this.mergeBlocks(),s.forEach(i=>{t.bounds.hit(i)&&!i.isEmpty()&&this.clipRender(i)})}clipRender(t){const s=nt.start("PartRender"),{canvas:i}=this,o=t.getIntersect(i.bounds),r=t.includes(this.target.__world),n=new tt().copy(o);i.save(),r&&!F.showRepaint?i.clear():(o.spread(1+1/this.canvas.pixelRatio).ceil(),i.clearWorld(o,!0),i.clipWorld(o,!0)),this.__render(o,n),i.restore(),nt.end(s)}fullRender(){const t=nt.start("FullRender"),{canvas:s}=this;s.save(),s.clear(),this.__render(s.bounds),s.restore(),nt.end(t)}__render(t,s){const i=t!=null&&t.includes(this.target.__world)?{}:{bounds:t};this.needFill&&this.canvas.fillWorld(t,this.config.fill),F.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,i),this.renderBounds=s||t,this.renderOptions=i,this.totalBounds.isEmpty()?this.totalBounds=this.renderBounds:this.totalBounds.add(this.renderBounds),F.showHitView&&this.renderHitView(i),F.showBoundsView&&this.renderBoundsView(i)}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const s=new tt;s.setByList(t),t.length=0,t.push(s)}}__requestRender(){const t=Date.now();A.requestRender(()=>{this.changed&&(this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-t))),this.running&&this.render())})}__onResize(t){if(!this.canvas.unreal&&(t.bigger||!t.samePixelRatio)){const{width:s,height:i}=t.old;new tt(0,0,s,i).includes(this.target.__world)&&!this.needFill&&t.samePixelRatio||(this.addBlock(this.canvas.bounds),this.target.forceUpdate("blendMode"))}}__onLayoutEnd(t){t.data&&t.data.map(s=>{let i;s.updatedList&&s.updatedList.list.some(o=>(i=!o.__world.width||!o.__world.height,i&&(ue.warn(o.innerName,": none bounds"),i=!o.isBranch||o.isBranchLeaf),i)),this.addBlock(i?this.canvas.bounds:s.updatedBounds)})}emitRender(t,s,i){this.target.emitEvent(new K(t,this.times,s,i))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(K.REQUEST,this.update,this),t.on_(I.END,this.__onLayoutEnd,this),t.on_(K.AGAIN,this.renderAgain,this),t.on_(ce.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.canvas=null,this.config=null)}}const{hitRadiusPoint:Oh}=R;class Lh{constructor(t,s){this.target=t,this.selector=s}getByPoint(t,s,i){s||(s=0),i||(i={});const o=i.through||!1,r=i.ignoreHittable||!1;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:s,radiusY:s},this.findList=[],this.eachFind(this.target.children,this.target.__onlyHitMask);const n=this.findList,a=this.getBestMatchLeaf(),l=r?this.getPath(a):this.getHitablePath(a);return this.clear(),o?{path:l,leaf:a,throughPath:n.length?this.getThroughPath(n):l}:{path:l,leaf:a}}getBestMatchLeaf(){const{findList:t}=this;if(t.length>1){let s;this.findList=[];const{x:i,y:o}=this.point,r={x:i,y:o,radiusX:0,radiusY:0};for(let n=0,a=t.length;n<a;n++)if(s=t[n],this.hitChild(s,r),this.findList.length)return this.findList[0]}return t[0]}getPath(t){const s=new st;for(;t;)s.push(t),t=t.parent;return s.push(this.target),s}getHitablePath(t){const s=this.getPath(t);let i,o=new st;for(let r=s.list.length-1;r>-1&&(i=s.list[r],i.__.hittable)&&(o.unshift(i),i.__.hitChildren);r--);return o}getThroughPath(t){const s=new st,i=[];for(let a=t.length-1;a>-1;a--)i.push(this.getPath(t[a]));let o,r,n;for(let a=0,l=i.length;a<l;a++){o=i[a],r=i[a+1];for(let c=0,u=o.length;c<u&&(n=o.list[c],!r||!r.has(n));c++)s.push(n)}return s}eachFind(t,s){let i,o;const{point:r}=this;for(let n=t.length-1;n>-1;n--)i=t[n],s&&!i.isMask||(o=Oh(i.__world,r),i.isBranch?(o||i.__ignoreHitWorld)&&(this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&!this.findList.length&&this.hitChild(i,r)):o&&this.hitChild(i,r))}hitChild(t,s){this.exclude&&this.exclude.has(t)||t.__hitWorld(s)&&this.findList.push(t)}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.target=null,this.selector=null}}class Yr{constructor(t,s){this.config={},this.innerIdList={},this.idList={},this.classNameList={},this.tagNameList={},this.target=t,s&&(this.config=et.default(s,this.config)),this.findPath=new Lh(t,this),this.__listenEvents()}getByPoint(t,s,i){return this.target.emit(I.CHECK_UPDATE),this.findPath.getByPoint(t,s,i)}find(t,s){return typeof t=="number"?this.getByInnerId(t,s):t.startsWith("#")?this.getById(t.substring(1),s):t.startsWith(".")?this.getByClassName(t.substring(1),s):this.getByTagName(t,s)}getByInnerId(t,s){let i;return this.innerIdList[t]||(s||(s=this.target),this.loopFind(s,r=>r.innerId===t&&(i=r,this.innerIdList[t]=i,!0)),i)}getById(t,s){let i;return this.idList[t]||(s||(s=this.target),this.loopFind(s,r=>r.id===t&&(i=r,this.idList[t]=i,!0)),i)}getByClassName(t,s){s||(s=this.target);let i=[];return this.loopFind(s,o=>(o.className===t&&i.push(o),!1)),i}getByTagName(t,s){s||(s=this.target);let i=[];return this.loopFind(s,o=>(o.__tag===t&&i.push(o),!1)),i}loopFind(t,s){if(s(t))return;const{children:i}=t;for(let o=0,r=i.length;o<r;o++){if(s(t=i[o]))return;t.isBranch&&this.loopFind(t,s)}}__onRemoveChild(t){const s=t.target;this.idList[s.id]&&(this.idList[s.id]=null),this.innerIdList[s.id]&&(this.innerIdList[s.innerId]=null)}__listenEvents(){this.__eventIds=[this.target.on_(Et.REMOVE,this.__onRemoveChild,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.__removeListenEvents(),this.findPath.destroy(),this.target=null,this.findPath=null,this.innerIdList=null,this.idList=null,this.classNameList=null,this.tagNameList=null)}}Object.assign(Z,{watcher:(e,t)=>new zr(e,t),layouter:(e,t)=>new as(e,t),renderer:(e,t,s)=>new jr(e,t,s),selector:(e,t)=>new Yr(e,t)});const No=F.get("LeaferCanvas");class Ri extends Br{init(){const{view:t}=this.config;if(this.offscreen)t?this.view=t:this.__createView();else{t?this.__createViewFrom(t):this.__createView();const{style:s}=this.view;this.autoLayout&&(s.display||(s.display="block")),this.parentView=this.view.parentElement}this.__createContext(),this.autoLayout||this.resize(this.config)}setBackgroundColor(t){this.view.style.backgroundColor=t}setHittable(t){this.view.style.pointerEvents=t?"auto":"none"}__createContext(){this.context=this.view.getContext("2d"),this.__bindContext()}__createView(){if(this.offscreen)try{return void(this.view=new OffscreenCanvas(1,1))}catch(t){No.error(t)}this.view=document.createElement("canvas")}__createViewFrom(t){let s=typeof t=="string"?document.getElementById(t):t;if(s)if(s instanceof HTMLCanvasElement)this.view=s;else{let i=s;if(s===window||s===document){const r=document.createElement("div"),{style:n}=r;n.position="absolute",n.top=n.bottom=n.left=n.right="0px",document.body.appendChild(r),i=r}this.__createView();const o=this.view;if(i.hasChildNodes()){const{style:r}=o;r.position="absolute",r.top=r.left="0px",i.style.position||(i.style.position="relative")}i.appendChild(o)}else No.error(`no id: ${t}`),this.__createView()}setViewSize(t){const{width:s,height:i,pixelRatio:o}=t;if(!this.offscreen){const{style:r}=this.view;r.width=s+"px",r.height=i+"px"}this.view.width=s*o,this.view.height=i*o}startAutoLayout(t,s){if(!this.offscreen){this.autoBounds=t,this.resizeListener=s;try{this.resizeObserver=new ResizeObserver(o=>{for(const r of o)this.checkAutoBounds(r.contentRect)});const i=this.parentView;i&&(this.resizeObserver.observe(i),this.checkAutoBounds(i.getBoundingClientRect()))}catch{this.imitateResizeObserver()}}}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),window.requestAnimationFrame(this.imitateResizeObserver.bind(this)))}checkAutoBounds(t){const s=this.view,{x:i,y:o,width:r,height:n}=this.autoBounds.getBoundsFrom(t);if(r!==this.width||n!==this.height){const{style:a}=s,{pixelRatio:l}=this;a.marginLeft=i+"px",a.marginTop=o+"px";const c={width:r,height:n,pixelRatio:l},u={};et.copyAttrs(u,this,Lt),this.resize(c),this.width!==void 0&&this.resizeListener(new ce(c,u))}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal&&!this.offscreen){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}const{drawRoundRect:Sh}=Gi;(function(){const e=CanvasRenderingContext2D.prototype;e.roundRect||(e.roundRect=Path2D.prototype.roundRect=function(t,s,i,o,r){Sh(this,t,s,i,o,r)})})();class Mh{constructor(t){this.interaction=t}move(t){const{interaction:s}=this;if(!this.moveData){const{path:i}=s.selector.getByPoint(t,s.hitRadius);t.path=i,this.moveData=Object.assign(Object.assign({},t),{moveX:0,moveY:0}),s.emit(gt.START,this.moveData)}t.path=this.moveData.path,s.emit(gt.MOVE,t),this.transformEndWait()}zoom(t){const{interaction:s}=this;if(!this.zoomData){const{path:i}=s.selector.getByPoint(t,s.hitRadius);t.path=i,this.zoomData=Object.assign(Object.assign({},t),{scale:1}),s.emit(St.START,this.zoomData)}t.path=this.zoomData.path,s.emit(St.ZOOM,t),this.transformEndWait()}rotate(t){const{interaction:s}=this;if(!this.rotateData){const{path:i}=s.selector.getByPoint(t,s.hitRadius);t.path=i,this.rotateData=Object.assign(Object.assign({},t),{rotation:0}),s.emit(qt.START,this.rotateData)}t.path=this.rotateData.path,s.emit(qt.ROTATE,t),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout(()=>{this.transformEnd()},this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd(),this.transformMode=null}moveEnd(){this.moveData&&(this.interaction.emit(gt.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(St.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(qt.END,this.rotateData),this.rotateData=null)}destroy(){clearTimeout(this.transformTimer),this.transformEnd(),this.interaction=null}}const Dt={getMoveEventData:(e,t,s)=>Object.assign(Object.assign({},s),{x:e.x,y:e.y,moveX:t.x,moveY:t.y}),getRotateEventData:(e,t,s)=>Object.assign(Object.assign({},s),{x:e.x,y:e.y,rotation:t}),getZoomEventData:(e,t,s)=>Object.assign(Object.assign({},s),{x:e.x,y:e.y,scale:t}),getDragEventData:(e,t,s)=>Object.assign(Object.assign({},s),{x:s.x,y:s.y,moveX:s.x-t.x,moveY:s.y-t.y,totalX:s.x-e.x,totalY:s.y-e.y}),getDropEventData:(e,t,s)=>Object.assign(Object.assign({},e),{list:t,data:s}),getSwipeDirection:e=>e<-45&&e>-135?wt.UP:e>45&&e<135?wt.DOWN:e<=45&&e>=-45?wt.RIGHT:wt.LEFT,getSwipeEventData:(e,t,s)=>Object.assign(Object.assign({},s),{moveX:t.moveX,moveY:t.moveY,totalX:s.x-e.x,totalY:s.y-e.y,type:Dh.getSwipeDirection(L.getAngle(e,s))}),getBase:e=>({altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,buttons:e.buttons===void 0?1:e.buttons,origin:e}),pathHasEventType(e,t){const{list:s}=e;for(let i=0,o=s.length;i<o;i++)if(s[i].hasEvent(t))return!0;return!1},filterPathByEventType(e,t){const s=new st,{list:i}=e;for(let o=0,r=i.length;o<r;o++)i[o].hasEvent(t)&&s.push(i[o]);return s}},Dh=Dt,{getDragEventData:ai,getDropEventData:Ah,getSwipeEventData:Ih,filterPathByEventType:Nh}=Dt;class Wh{constructor(t){this.interaction=t}setDragData(t){this.dragData=ai(t,t,t)}getDragList(){return this.dragging?$t.dragList||this.dragList:null}checkDrag(t,s){const{interaction:i}=this,{downData:o}=i;if(this.moving&&!Kt.middle(t)&&!Kt.left(t))return void i.pointerCancel();const{dragData:r}=this;if(!this.moving){const l=o.target.isLeafer&&i.config.move.dragEmpty;this.moving=(Kt.middle(t)||ve.isHoldSpaceKey()||l)&&s,this.moving&&i.emit(gt.START,r)}this.moving||this.dragStart(t,s);const{path:n,throughPath:a}=o;this.dragData=ai(o,r,t),a&&(this.dragData.throughPath=a),this.dragData.path=n,this.moving?i.emit(gt.MOVE,this.dragData):this.dragging&&(i.emit(V.DRAG,this.dragData),this.dragDragableList())}dragStart(t,s){this.dragging||(this.dragging=Kt.left(t)&&s,this.dragging&&(this.interaction.emit(V.START,this.dragData),this.getDragableList(this.dragData.path),this.dragList=Nh(this.dragData.path,V.DRAG),!this.dragList.length&&this.dragableList&&this.dragList.pushList(this.dragableList)))}getDragableList(t){let s;for(let i=0,o=t.length;i<o;i++)if(s=t.list[i],s.__.draggable&&s.__.hitSelf){this.dragableList=[s];break}}dragDragableList(){const{running:t}=this.interaction;if(this.dragableList&&t){const{moveX:s,moveY:i}=this.dragData;this.dragableList.forEach(o=>{me.move(o,s,i)})}}dragOverOrOut(t){const{interaction:s}=this,{dragOverPath:i}=this,{path:o}=t;i?o.indexAt(0)!==i.indexAt(0)&&(s.emit(V.OUT,t,i),s.emit(V.OVER,t,o)):s.emit(V.OVER,t,o),this.dragOverPath=o}dragEnterOrLeave(t){const{interaction:s}=this,{dragEnterPath:i}=this,{path:o}=t;s.emit(V.ENTER,t,o,i),s.emit(V.LEAVE,t,i,o),this.dragEnterPath=o}dragEnd(t){const{interaction:s}=this,{downData:i}=s;if(!i)return;const{path:o,throughPath:r}=i,n=ai(i,t,t);r&&(n.throughPath=r),n.path=o,this.moving&&s.emit(gt.END,n),this.dragging&&(s.emit(V.END,n),this.swipe(t,n),this.drop(t)),this.autoMoveCancel(),this.dragReset()}swipe(t,s){const{interaction:i}=this,{downData:o}=i;if(L.getDistance(o,t)>i.config.pointer.swipeDistance){const r=Ih(o,this.dragData,s);this.interaction.emit(r.type,r)}}drop(t){const s=Ah(t,this.getDragList(),$t.dragData);s.path=this.dragEnterPath,this.interaction.emit($t.DROP,s),this.interaction.emit(V.LEAVE,t,this.dragEnterPath)}dragReset(){$t.dragList=null,this.dragList=null,this.dragableList=null,this.dragData=null,this.dragOverPath=null,this.dragEnterPath=null,this.dragging=null,this.moving=null}checkDragOut(t){const{interaction:s}=this;this.autoMoveCancel(),this.dragging&&!s.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:s}=this,{downData:i}=s,{autoDistance:o,dragOut:r}=s.config.move;if(!r||!o)return;const n=s.shrinkCanvasBounds,{x:a,y:l}=n,c=R.right(n),u=R.bottom(n),h=t.x<a?o:c<t.x?-o:0,_=t.y<l?o:u<t.y?-o:0;let p=0,m=0;this.autoMoveTimer=setInterval(()=>{p+=h,m+=_,R.move(i,h,_),R.move(this.dragData,h,_),s.move(Object.assign(Object.assign({},t),{moveX:h,moveY:_,totalX:p,totalY:m})),s.pointerMoveReal(t)},10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.interaction=null,this.dragableList=null}}const Fh=["move","zoom","rotate"];function Wo(e,t,s,i,o){if(Fh.some(r=>t.startsWith(r))&&e.__.hitChildren&&!Hr(e,o)){let r;for(let n=0,a=e.children.length;n<a;n++)r=e.children[n],!s.path.has(r)&&r.__.hittable&&Pi(r,t,s,i,o)}}function Pi(e,t,s,i,o){if(e.__.hitSelf&&e.hasEvent(t,i)&&!Hr(e,o)){s.phase=i?1:e===s.target?2:3;const r=hs.get(t,s);if(e.emitEvent(r,i),r.isStop)return!0}return!1}function Hr(e,t){return t&&t.has(e)}const{pathHasEventType:Fo}=Dt;class zh{get dragging(){return this.dragger.dragging}get hitRadius(){return this.config.pointer.hitRadius}constructor(t,s,i,o){this.config={wheel:{zoomMode:!1,zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8},preventDefault:!0},pointer:{hitRadius:5,through:!1,tapTime:120,longPressTime:800,transformTime:500,dragHover:!0,dragDistance:2,swipeDistance:20,ignoreMove:!1}},this.tapCount=0,this.target=t,this.canvas=s,this.selector=i,this.defaultPath=new st(t),this.transformer=new Mh(this),this.dragger=new Wh(this),o&&(this.config=et.default(o,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}pointerDown(t){this.emit(C.BEFORE_DOWN,t,this.defaultPath);const{hitRadius:s,through:i}=this.config.pointer,o=this.selector.getByPoint(t,s,{through:i});o.throughPath&&(t.throughPath=o.throughPath),t.path=o.path,this.emit(C.DOWN,t),this.downData=t,this.downTime=Date.now(),this.dragger.setDragData(t),Kt.left(t)&&(this.tapWait(),this.longPressWait(t))}pointerMove(t){(this.downData||this.canvas.bounds.hitPoint(t))&&(this.pointerMoveReal(t),this.dragger.checkDragOut(t))}pointerMoveReal(t){if(this.emit(C.BEFORE_MOVE,t,this.defaultPath),this.downData){const i=L.getDistance(this.downData,t)>this.config.pointer.dragDistance;this.waitTap&&i&&this.pointerWaitCancel(),this.dragger.checkDrag(t,i)}if(this.dragger.moving||this.config.pointer.ignoreMove)return;const s=this.selector.getByPoint(t,this.hitRadius,{exclude:this.dragger.getDragList(),name:C.MOVE});t.path=s.path,this.emit(C.MOVE,t),this.pointerOverOrOut(t),this.pointerEnterOrLeave(t),this.dragger.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))}pointerUp(t){if(!this.downData)return;this.emit(C.BEFORE_UP,t,this.defaultPath);const{through:s}=this.config.pointer,i=this.selector.getByPoint(t,this.hitRadius,{through:s});i.throughPath&&(t.throughPath=i.throughPath),t.path=i.path,this.emit(C.UP,t),this.emit(C.UP,this.downData,void 0,t.path),this.touchLeave(t),this.tap(t),this.dragger.dragEnd(t),this.downData=null}pointerCancel(){this.pointerUp(this.dragger.dragData)}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}pointerOverOrOut(t){if(this.dragger.moving||this.dragging&&!this.config.pointer.dragHover)return;const{path:s}=t;this.overPath?s.indexAt(0)!==this.overPath.indexAt(0)&&(this.emit(C.OUT,t,this.overPath),this.emit(C.OVER,t,s)):this.emit(C.OVER,t,s),this.overPath=s}pointerEnterOrLeave(t){if(this.dragger.moving||this.dragging&&!this.config.pointer.dragHover)return;const{path:s}=t;this.emit(C.ENTER,t,s,this.enterPath),this.emit(C.LEAVE,t,this.enterPath,s),this.enterPath=s}touchLeave(t){t.pointerType==="touch"&&this.enterPath&&(this.emit(C.LEAVE,t),this.dragger.dragging&&this.emit($t.LEAVE,t))}tap(t){const{pointer:s}=this.config,i=this.longTap(t);if(!s.tapMore&&i||!this.waitTap)return;s.tapMore&&this.emitTap(t);const o=Date.now()-this.downTime,r=[C.DOUBLE_TAP,C.DOUBLE_CLICK].some(n=>Fo(t.path,n));o<s.tapTime+50&&r?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{s.tapMore||(this.tapWaitCancel(),this.emitTap(t))},s.tapTime))):s.tapMore||(this.tapWaitCancel(),this.emitTap(t))}emitTap(t){this.emit(C.TAP,t),this.emit(C.CLICK,t)}emitDoubleTap(t){this.emit(C.DOUBLE_TAP,t),this.emit(C.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(C.LONG_PRESS,t)},this.config.pointer.longPressTime)}longTap(t){let s;return this.longPressed&&(this.emit(C.LONG_TAP,t),Fo(t.path,C.LONG_TAP)&&(s=!0)),this.longPressWaitCancel(),s}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new tt(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(ce.RESIZE,this.__onResize,this)],this.__onResize()}__removeListenEvents(){this.target.off_(this.__eventIds)}emit(t,s,i,o){this.running&&function(r,n,a,l){if(!a&&!n.path)return;let c;n.type=r,a?n=Object.assign(Object.assign({},n),{path:a}):a=n.path,n.target=a.indexAt(0);for(let u=a.length-1;u>-1;u--){if(c=a.list[u],Pi(c,r,n,!0,l))return;c.isApp&&Wo(c,r,n,!0,l)}for(let u=0,h=a.length;u<h;u++)if(c=a.list[u],c.isApp&&Wo(c,r,n,!1,l),Pi(c,r,n,!1,l))return}(t,s,i,o)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.config=null,this.target=null,this.selector=null,this.canvas=null,this.dragger=null,this.transformer=null)}}const _t={convert(e,t){const s=Dt.getBase(e),i=Object.assign(Object.assign({},s),{x:t.x,y:t.y,width:e.width,height:e.height,pointerType:e.pointerType,pressure:e.pressure});return i.pointerType==="pen"&&(i.tangentialPressure=e.tangentialPressure,i.tiltX=e.tiltX,i.tiltY=e.tiltY,i.twist=e.twist),i},convertMouse(e,t){const s=Dt.getBase(e);return Object.assign(Object.assign({},s),{x:t.x,y:t.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(e,t){const s=_t.getTouch(e),i=Dt.getBase(e);return Object.assign(Object.assign({},i),{x:t.x,y:t.y,width:1,height:1,pointerType:"touch",pressure:s.force})},getTouch:e=>e.targetTouches[0]||e.changedTouches[0]},hi={getData(e,t){const s=L.getCenter(e[0],e[1]),i=L.getCenter(t[0],t[1]),o={x:i.x-s.x,y:i.y-s.y},r=L.getDistance(e[0],e[1]),n=L.getDistance(t[0],t[1])/r,a=L.getAngle(e[0],e[1]),l=L.getAngle(t[0],t[1]);return{move:o,scale:n,angle:this.getChangedAngle(a,l),center:i}},getTouches(e){const t=[];for(let s=0,i=e.length;s<i;s++)t.push(e[s]);return t},getChangedAngle(e,t){const s=(t=t<=-90?360+t:t)-(e=e<=-90?360+e:e);return s<0?s+360:s}},zo={getMove:(e,t)=>({x:-e.deltaX*t.moveSpeed*2,y:-e.deltaY*t.moveSpeed*2}),getScale(e,t){let s,i=1,{zoomMode:o,zoomSpeed:r}=t;const n=e.deltaY||e.deltaX;if(o){const a=A.intWheelDeltaY&&Math.abs(e.deltaY)>17;s=(Math.floor(e.deltaY)!==e.deltaY||a)&&e.deltaX===0,(e.shiftKey||e.metaKey||e.ctrlKey)&&(s=!0)}else s=!e.shiftKey&&(e.metaKey||e.ctrlKey);return s&&(r=Fe.within(r,0,1),i=1-n/(25*(e.deltaY?t.delta.y:t.delta.x)*(1-r)+10),i<.5&&(i=.5),i>=1.5&&(i=1.5)),i}},{getMoveEventData:jo,getZoomEventData:li,getRotateEventData:Yo}=Dt;class Ur extends zh{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp};const{viewEvents:s,windowEvents:i}=this;for(let o in s)s[o]=s[o].bind(this),t.addEventListener(o,s[o]);for(let o in i)i[o]=i[o].bind(this),window.addEventListener(o,i[o])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:s}=this;for(let i in t)this.view.removeEventListener(i,t[i]),this.viewEvents={};for(let i in s)window.removeEventListener(i,s[i]),this.windowEvents={}}getLocal(t){const s=this.view.getBoundingClientRect();return{x:t.clientX-s.x,y:t.clientY-s.y}}preventDefaultPointer(t){const{pointer:s}=this.config;s.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:s}=this.config;s.preventDefault&&t.preventDefault()}onKeyDown(t){ve.setDownCode(t.code)}onKeyUp(t){ve.setUpCode(t.code)}onPointerDown(t){this.preventDefaultPointer(t),this.usePointer||(this.usePointer=!0),this.useMutiTouch||this.pointerDown(_t.convert(t,this.getLocal(t)))}onPointerMove(t){this.usePointer||(this.usePointer=!0),this.useMutiTouch||this.pointerMove(_t.convert(t,this.getLocal(t)))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.useMutiTouch||this.pointerUp(_t.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMutiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.pointerDown(_t.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.pointerMove(_t.convertMouse(t,this.getLocal(t)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.pointerUp(_t.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){if(t.preventDefault(),this.mutiTouchStart(t),this.usePointer)return;this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0;const s=_t.getTouch(t);this.pointerDown(_t.convertTouch(t,this.getLocal(s)))}onTouchMove(t){if(this.mutiTouchMove(t),this.usePointer)return;const s=_t.getTouch(t);this.pointerMove(_t.convertTouch(t,this.getLocal(s)))}onTouchEnd(t){if(this.mutiTouchEnd(),this.usePointer)return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const s=_t.getTouch(t);this.pointerUp(_t.convertTouch(t,this.getLocal(s)))}onTouchCancel(){this.usePointer||this.pointerCancel()}mutiTouchStart(t){this.useMutiTouch=t.touches.length>=2,this.touches=this.useMutiTouch?hi.getTouches(t.touches):void 0,this.useMutiTouch&&this.pointerCancel()}mutiTouchMove(t){if(this.useMutiTouch&&t.touches.length>=2){const s=hi.getTouches(t.touches),i=s.find(r=>r.identifier===this.touches[0].identifier),o=s.find(r=>r.identifier===this.touches[1].identifier);if(i&&o){const r=[this.getLocal(this.touches[0]),this.getLocal(this.touches[1])],n=[this.getLocal(i),this.getLocal(o)],{move:a,angle:l,scale:c,center:u}=hi.getData(r,n),h=Dt.getBase(t);this.rotate(Yo(u,l,h)),this.zoom(li(u,c,h)),this.move(jo(u,a,h)),this.touches=s}}}mutiTouchEnd(){this.touches=null,this.useMutiTouch=!1,this.transformEnd()}onWheel(t){this.preventDefaultWheel(t);const{wheel:s}=this.config,i=s.getScale?s.getScale(t,s):zo.getScale(t,s),o=this.getLocal(t),r=Dt.getBase(t);i!==1?this.zoom(li(o,i,r)):this.move(jo(o,s.getMove?s.getMove(t,s):zo.getMove(t,s),r))}onGesturestart(t){this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0}onGesturechange(t){this.preventDefaultWheel(t);const s=this.getLocal(t),i=Dt.getBase(t),o=t.scale/this.lastGestureScale,r=t.rotation-this.lastGestureRotation;let{rotateSpeed:n}=this.config.wheel;n=Fe.within(n,0,1),this.zoom(li(s,o*o,i)),this.rotate(Yo(s,r/Math.PI*180*(n/4+.1),i)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.preventDefaultWheel(t),this.transformEnd()}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}Object.assign(Z,{canvas:(e,t)=>new Ri(e,t),image:e=>new ki(e),hitCanvas:(e,t)=>new Ri(e,t),interaction:(e,t,s,i)=>new Ur(e,t,s,i)}),A.requestRender=function(e){window.requestAnimationFrame(e)},A.devicePixelRatio=devicePixelRatio;const{userAgent:di}=navigator;di.indexOf("Firefox")>-1?(A.conicGradientRotate90=!0,A.intWheelDeltaY=!0):di.indexOf("Safari")>-1&&di.indexOf("Chrome")===-1&&(A.fullImageShadow=!0),A.origin={createCanvas(e,t){const s=document.createElement("canvas");return s.width=e,s.height=t,s},loadImage:e=>new Promise((t,s)=>{const i=new Image;i.setAttribute("crossOrigin","anonymous"),i.crossOrigin="anonymous",i.onload=()=>{t(i)},i.onerror=o=>{s(o)},e.startsWith("data:")||e.includes("?"),i.src=e})},A.canvas=Z.canvas(),A.conicGradientSupport=!!A.canvas.context.createConicGradient;const Ho=F.get("LeaferTypeCreator"),We={list:{},register(e,t){Uo[e]?Ho.error("repeat:",e):Uo[e]=t},run(e,t){const s=We.list[e];s?s(t):Ho.error("no",e)}},{list:Uo}=We;We.register("user",function(e){const{config:t}=e;t.move.dragOut=!1}),We.register("design",function(e){const{MOVE:t}=gt,{ZOOM:s}=St;e.__eventIds.push(e.on_(t,i=>{me.move(e.moveLayer,i.moveX,i.moveY)}),e.on_(s,i=>{const{scaleX:o}=e.zoomLayer.__,{min:r,max:n}=e.config.zoom;let{scale:a}=i;a*o<r?a=r/o:a*o>n&&(a=n/o),a!==1&&me.zoomOf(e.zoomLayer,i,a)}))});const Ms={},$={},jh={},Yh={},{copy:Xo,toOffsetOutBounds:Hh}=R,ht={},bs={};function Vo(e,t,s,i){const{bounds:o,shapeBounds:r}=i;if(A.fullImageShadow){if(Xo(ht,e.bounds),ht.x+=t.x-r.x,ht.y+=t.y-r.y,s){const{matrix:n}=i;ht.x-=(o.x+(n?n.e:0)+o.width/2)*(s-1),ht.y-=(o.y+(n?n.f:0)+o.height/2)*(s-1),ht.width*=s,ht.height*=s}e.copyWorld(i.canvas,e.bounds,ht)}else s&&(Xo(ht,t),ht.x-=t.width/2*(s-1),ht.y-=t.height/2*(s-1),ht.width*=s,ht.height*=s),e.copyWorld(i.canvas,r,s?ht:t)}const{toOffsetOutBounds:Uh}=R,Bs={};var Xh=Object.freeze({__proto__:null,blur:function(e,t,s){const{blur:i}=e.__;s.setWorldBlur(i*e.__world.a),s.copyWorldToInner(t,e.__world,e.__layout.renderBounds),s.filter="none"},innerShadow:function(e,t,s){let i,o;const{__world:r,__layout:n}=e,{innerShadow:a}=e.__,{worldCanvas:l,bounds:c,shapeBounds:u,scaleX:h,scaleY:_}=s,p=t.getSameCanvas(),m=a.length-1;Uh(c,Bs),a.forEach((g,v)=>{p.save(),p.setWorldShadow(Bs.offsetX+g.x*h,Bs.offsetY+g.y*_,g.blur*h),o=g.spread?1-2*g.spread/(n.boxBounds.width+2*(n.strokeBoxSpread||0)):0,Vo(p,Bs,o,s),p.restore(),l?(p.copyWorld(p,c,r,"copy"),p.copyWorld(l,r,r,"source-out"),i=r):(p.copyWorld(s.canvas,u,c,"source-out"),i=c),p.fillWorld(i,g.color,"source-in"),t.copyWorldToInner(p,i,n.renderBounds,g.blendMode),m&&v<m&&p.clear()}),p.recycle()},shadow:function(e,t,s){let i,o;const{__world:r,__layout:n}=e,{shadow:a}=e.__,{worldCanvas:l,bounds:c,shapeBounds:u,scaleX:h,scaleY:_}=s,p=t.getSameCanvas(),m=a.length-1;Hh(c,bs),a.forEach((g,v)=>{p.setWorldShadow(bs.offsetX+g.x*h,bs.offsetY+g.y*_,g.blur*h,g.color),o=g.spread?1+2*g.spread/(n.boxBounds.width+2*(n.strokeBoxSpread||0)):0,Vo(p,bs,o,s),i=c,g.box&&(p.restore(),p.save(),l&&(p.copyWorld(p,c,r,"copy"),i=r),l?p.copyWorld(l,r,r,"destination-out"):p.copyWorld(s.canvas,u,c,"destination-out")),t.copyWorldToInner(p,i,n.renderBounds,g.blendMode),m&&v<m&&p.clear()}),p.recycle()}});function ge(e,t){let s;const{rows:i,decorationY:o,decorationHeight:r}=e.__.__textDrawData;for(let n=0,a=i.length;n<a;n++)s=i[n],s.text?t.fillText(s.text,s.x,s.y):s.data&&s.data.forEach(l=>{t.fillText(l.char,l.x,s.y)}),o&&t.fillRect(s.x,s.y+o,s.width,r)}function Go(e,t,s){const{strokeAlign:i}=e.__;switch(i){case"center":t.setStroke(s,e.__.strokeWidth,e.__),rs(e,t);break;case"inside":Oi(e,t,s,"inside");break;case"outside":Oi(e,t,s,"outside")}}function Oi(e,t,s,i){const{strokeWidth:o,__font:r}=e.__,n=t.getSameCanvas(!0);n.setStroke(s,2*o,e.__),n.font=r,rs(e,n),n.blendMode=i==="outside"?"destination-out":"destination-in",ge(e,n),n.blendMode="normal",t.copyWorldToInner(n,e.__world,e.__layout.renderBounds),n.recycle()}function qo(e,t,s){const{strokeAlign:i}=e.__;switch(i){case"center":t.setStroke(void 0,e.__.strokeWidth,e.__),Ko(e,s,t);break;case"inside":Oi(e,t,s,"inside");break;case"outside":(function(o,r,n,a){const{strokeWidth:l,__font:c}=o.__,u=r.getSameCanvas(!0);u.setStroke(void 0,2*l,o.__),u.font=c,Ko(o,n,u),u.blendMode=a==="outside"?"destination - out":"destination -in ",ge(o,u),u.blendMode="normal",r.copyWorldToInner(u,o.__world,o.__layout.renderBounds),u.recycle()})(e,t,s,"outside")}}function Ko(e,t,s){t.forEach(i=>{s.strokeStyle=i.style,i.blendMode?(s.saveBlendMode(i.blendMode),rs(e,s),s.restoreBlendMode()):rs(e,s)})}function rs(e,t){let s;const{rows:i,decorationY:o,decorationHeight:r}=e.__.__textDrawData;for(let n=0,a=i.length;n<a;n++)s=i[n],s.text?t.strokeText(s.text,s.x,s.y):s.data&&s.data.forEach(l=>{t.strokeText(l.char,l.x,s.y)}),o&&t.strokeRect(s.x,s.y+o,s.width,r)}function ci(e,t){e.forEach(s=>{t.strokeStyle=s.style,s.blendMode?(t.saveBlendMode(s.blendMode),t.stroke(),t.restoreBlendMode()):t.stroke()})}const{getSpread:Vh,getOuterOf:Gh,getByMove:qh,getIntersectData:Kh}=R,Li={string(e,t){if(typeof e=="string")return e;let s=e.a===void 0?1:e.a;t&&(s*=t);const i=e.r+","+e.g+","+e.b;return s===1?"rgb("+i+")":"rgba("+i+","+s+")"}},{get:Es,rotateOf:$h,translate:se,scaleOf:Qh,scale:ui,rotate:$o}=O;function Zh(e,t,s,i){let{type:o,blendMode:r}=s,n={type:o,blendMode:r,style:"rgba(255,255,255,0)"};const a=e.leafer.imageManager.get(s);if(a.ready){let l,{opacity:c,mode:u,offset:h,scale:_,rotation:p}=s,{width:m,height:g}=a;const v=i.width===m&&i.height===g;switch(u){case"strench":v||(m=i.width,g=i.height),(i.x||i.y)&&(l=Es(),se(l,i.x,i.y));break;case"clip":(h||_||p)&&(l=function(f,y,w,x){const B=Es();return se(B,f.x,f.y),y&&se(B,y.x,y.y),w&&(typeof w=="number"?ui(B,w):ui(B,w.x,w.y)),x&&$o(B,x),B}(i,h,_,p));break;case"repeat":(!v||_||p)&&(l=function(f,y,w,x,B){const k=Es();if(B)switch($o(k,B),B){case 90:se(k,w,0);break;case 180:se(k,y,w);break;case 270:se(k,0,y)}return se(k,f.x,f.y),x&&Qh(k,f,x),k}(i,m,g,_,p));break;default:v&&!p||(l=function(f,y,w,x,B){const k=Es(),P=B&&B!==180,T=y.width/(P?x:w),D=y.height/(P?w:x),N=f==="fit"?Math.min(T,D):Math.max(T,D),H=y.x+(y.width-w*N)/2,U=y.y+(y.height-x*N)/2;return se(k,H,U),ui(k,N),B&&$h(k,{x:y.x+y.width/2,y:y.y+y.height/2},B),k}(u,i,m,g,p))}n.style=function(f,y,w){let x=A.canvas.createPattern(f,w?"repeat":"no-repeat");if(y){const{a:B,b:k,c:P,d:T,e:D,f:N}=y;x.setTransform(new DOMMatrix([B,k,P,T,D,N]))}return x}(a.getCanvas(m,g,c),l,u==="repeat")}else a.load(()=>{e.__.__getInput("width")||(e.width=a.width),e.__.__getInput("height")||(e.height=a.height),e.forceUpdate("width"),e.emitEvent(new ne(ne.LOADED,e,a,t,s))},l=>{e.emitEvent(new ne(ne.ERROR,e,a,t,s,l))});return n}const Jh={x:.5,y:0},tl={x:.5,y:1};function pi(e,t,s){let i;for(let o=0,r=t.length;o<r;o++)i=t[o],e.addColorStop(i.offset,Li.string(i.color,s))}const{set:Qo,getAngle:el,getDistance:sl}=L,{get:il,rotateOf:ol,scaleOf:rl}=O,nl={x:.5,y:.5},al={x:.5,y:1},Ht={},_i={},{set:Zo,getAngle:hl,getDistance:ll}=L,{get:dl,rotateOf:Jo,scaleOf:tr}=O,cl={x:.5,y:.5},ul={x:.5,y:1},pt={},gi={};function er(e,t){let s,i=e.__.__input[t];const o=[];i instanceof Array||(i=[i]);for(let r=0,n=i.length;r<n;r++)s=pl(e,i[r],t),s&&o.push(s);e.__["_"+t]=o.length?o:void 0}function pl(e,t,s){if(typeof t!="object"||t.visible===!1||t.opacity===0)return;const{boxBounds:i}=e.__layout;switch(t.type){case"solid":let{type:o,blendMode:r,color:n,opacity:a}=t;return{type:o,blendMode:r,style:Li.string(n,a)};case"image":return Zh(e,s,t,i);case"linear":return function(l,c){let{from:u,to:h,type:_,blendMode:p,opacity:m}=l;u||(u=Jh),h||(h=tl);const g=A.canvas.createLinearGradient(c.x+u.x*c.width,c.y+u.y*c.height,c.x+h.x*c.width,c.y+h.y*c.height);return pi(g,l.stops,m),{type:_,blendMode:p,style:g}}(t,i);case"radial":return function(l,c){let{from:u,to:h,type:_,opacity:p,blendMode:m,stretch:g}=l;u||(u=nl),h||(h=al);const{x:v,y:f,width:y,height:w}=c;let x;Qo(Ht,v+u.x*y,f+u.y*w),Qo(_i,v+h.x*y,f+h.y*w),(y!==w||g)&&(x=il(),rl(x,Ht,y/w*(g||1),1),ol(x,Ht,el(Ht,_i)+90));const B=A.canvas.createRadialGradient(Ht.x,Ht.y,0,Ht.x,Ht.y,sl(Ht,_i));return pi(B,l.stops,p),{type:_,blendMode:m,style:B,transform:x}}(t,i);case"angular":return function(l,c){let{from:u,to:h,type:_,opacity:p,blendMode:m,stretch:g}=l;u||(u=cl),h||(h=ul);const{x:v,y:f,width:y,height:w}=c;Zo(pt,v+u.x*y,f+u.y*w),Zo(gi,v+h.x*y,f+h.y*w);const x=dl(),B=hl(pt,gi);A.conicGradientRotate90?(tr(x,pt,y/w*(g||1),1),Jo(x,pt,B+90)):(tr(x,pt,1,y/w*(g||1)),Jo(x,pt,B));const k=A.conicGradientSupport?A.canvas.createConicGradient(0,pt.x,pt.y):A.canvas.createRadialGradient(pt.x,pt.y,0,pt.x,pt.y,ll(pt,gi));return pi(k,l.stops,p),{type:_,blendMode:m,style:k,transform:x}}(t,i);default:return t.r?{type:"solid",style:Li.string(t)}:void 0}}var _l=Object.freeze({__proto__:null,computeFill:function(e){er(e,"fill")},computeStroke:function(e){er(e,"stroke")},drawText:ge,drawTextStroke:rs,fill:function(e,t,s){t.fillStyle=s,e.__.__font?ge(e,t):t.fill(e.__.windingRule)},fills:function(e,t,s){let i;const{windingRule:o,__font:r}=e.__;for(let n=0,a=s.length;n<a;n++)if(i=s[n],t.fillStyle=i.style,i.transform){t.save();const{a:l,b:c,c:u,d:h,e:_,f:p}=i.transform;t.transform(l,c,u,h,_,p),i.blendMode&&(t.blendMode=i.blendMode),r?ge(e,t):t.fill(o),t.restore()}else i.blendMode?(t.saveBlendMode(i.blendMode),r?ge(e,t):t.fill(o),t.restoreBlendMode()):r?ge(e,t):t.fill(o)},shape:function(e,t,s){const i=t.getSameCanvas();let o,r,n,a;const{__world:l}=e;let{a:c,d:u}=l;if(t.bounds.includes(l,s.matrix))o=n=l,a=i;else{const{renderShapeSpread:h}=e.__layout,_=Kh(h?Vh(t.bounds,h*c):t.bounds,l,s.matrix);r=t.bounds.getFitMatrix(_),r.a<1&&(a=t.getSameCanvas(),e.__renderShape(a,s),c*=r.a,u*=r.d),n=Gh(l,r),o=qh(n,-r.e,-r.f),s.matrix&&r.multiply(s.matrix),s=Object.assign(Object.assign({},s),{matrix:r})}return e.__renderShape(i,s),{canvas:i,matrix:r,bounds:o,worldCanvas:a,shapeBounds:n,scaleX:c,scaleY:u}},stroke:function(e,t,s){const i=e.__,{strokeWidth:o,strokeAlign:r,__font:n}=i;if(n)Go(e,t,s);else switch(r){case"center":t.setStroke(s,o,i),t.stroke();break;case"inside":t.save(),t.setStroke(s,2*o,i),t.clip(i.windingRule),t.stroke(),t.restore();break;case"outside":const a=t.getSameCanvas(!0);a.setStroke(s,2*o,e.__),e.__drawRenderPath(a),a.stroke(),a.clip(i.windingRule),a.clearWorld(e.__layout.renderBounds),t.copyWorldToInner(a,e.__world,e.__layout.renderBounds),a.recycle()}},strokeText:Go,strokes:function(e,t,s){const i=e.__,{strokeWidth:o,strokeAlign:r,__font:n}=i;if(n)qo(e,t,s);else switch(r){case"center":t.setStroke(void 0,o,i),ci(s,t);break;case"inside":t.save(),t.setStroke(void 0,2*o,i),t.clip(i.windingRule),ci(s,t),t.restore();break;case"outside":const{renderBounds:a}=e.__layout,l=t.getSameCanvas(!0);e.__drawRenderPath(l),l.setStroke(void 0,2*o,e.__),ci(s,l),l.clip(i.windingRule),l.clearWorld(a),t.copyWorldToInner(l,e.__world,a),l.recycle()}},strokesText:qo});Object.assign(Ms,Xh),Object.assign($,_l);class Jt extends Wi{setBlendMode(t){this._blendMode=t,t!=="pass-through"&&t?this.__blendLayer=!0:this.__blendLayer&&(this.__blendLayer=!1)}setFill(t){typeof t!="string"&&t?typeof t=="object"&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged?this._fill=t:$.computeFill(this.__leaf),this.__isFills=!0):(this._fill=t,this.__input&&this.__removeInput("fill"),this.__isFills&&(this.__isFills=!1))}setStroke(t){typeof t!="string"&&t?typeof t=="object"&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged?this._stroke=t:$.computeStroke(this.__leaf),this.__isStrokes=!0):(this._stroke=t,this.__input&&this.__removeInput("stroke"),this.__isStrokes&&(this.__isStrokes=!1))}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some(s=>s.visible===!1)&&(t=t.filter(s=>s.visible!==!1)),this._shadow=t.length?t:null):this._shadow=t?t.visible===!1?null:[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some(s=>s.visible===!1)&&(t=t.filter(s=>s.visible!==!1)),this._innerShadow=t.length?t:null):this._innerShadow=t?t.visible===!1?null:[t]:null}}const sr={number:(e,t)=>typeof e=="object"?e.type==="percent"?e.value/100*t:e.value:e};class zs extends Jt{}class Xr extends zs{get __boxStroke(){return!0}}class Vr extends Jt{get __boxStroke(){return!0}}const{parse:gl}=de,fl={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class Gr extends Vr{}function De(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),i&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}})}}function Qe(e){return(t,s)=>{at(t,s,e,{set(i){this.__setAttr(s,i),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}})}}const qr={__updateStrokeSpread(){let e=0,t=0;const{stroke:s,hitStroke:i,strokeAlign:o,strokeWidth:r}=this.__;if((s||i==="all")&&r&&o!=="inside"&&(t=e=o==="center"?r/2:r,!this.__.__boxStroke)){const{miterLimit:n,strokeCap:a}=this.__,l=this.__tag!=="Line"?1/Math.sin(n*M/2)*Math.sqrt(r)-e:0;e+=Math.max(l,a==="none"?0:r)}return this.__layout.strokeBoxSpread=t,e},__updateRenderSpread(){let e=0;const{shadow:t,innerShadow:s,blur:i,backgroundBlur:o}=this.__;t&&t.forEach(n=>{e=Math.max(e,Math.max(Math.abs(n.y),Math.abs(n.x))+(n.spread>0?n.spread:0)+1.5*n.blur)}),i&&(e=Math.max(e,i));let r=e=Math.ceil(e);return s&&s.forEach(n=>{r=Math.max(r,Math.max(Math.abs(n.y),Math.abs(n.x))+(n.spread<0?-n.spread:0)+1.5*n.blur)}),o&&(r=Math.max(r,o)),this.__layout.renderShapeSpread=r,e}},Kr={__updateHitCanvas(){this.__hitCanvas||(this.__hitCanvas=this.leafer.hitCanvasManager.getPathType(this)),this.__drawHitPath(this.__hitCanvas),this.__hitCanvas.setStrokeOptions(this.__)},__hit(e){const{__hitCanvas:t}=this,{fill:s,hitFill:i,windingRule:o}=this.__,r=s&&i==="path"||i==="all";if(r&&t.hitFill(e,o))return!0;const{stroke:n,hitStroke:a,strokeWidth:l,strokeAlign:c}=this.__,u=n&&a==="path"||a==="all",h=2*e.radiusX;let _=2*(u?c==="center"?l/2:l:0)+h;if(!_)return!1;switch(c){case"inside":if(!r&&t.hitFill(e,o)&&t.hitStroke(e,_))return!0;_=h;break;case"outside":if(!r){if(!t.hitFill(e,o)&&t.hitStroke(e,_))return!0;_=h}}return!!_&&t.hitStroke(e,_)}},$r={__updateChange(){let e=this.__;if(e.__useEffect){const{shadow:t,innerShadow:s,blur:i,backgroundBlur:o}=this.__;e.__useEffect=!!(t||s||i||o)}e.__isFills||e.__isStrokes||e.cornerRadius||e.__useEffect||e.blendMode&&e.blendMode!=="pass-through"?e.__complex=!0:e.__complex&&(e.__complex=!1)},__drawFast(e,t){const{fill:s,stroke:i,__drawAfterFill:o}=this.__;this.__drawRenderPath(e),s&&$.fill(this,e,s),o&&this.__drawAfterFill(e,t),i&&$.stroke(this,e,i)},__draw(e,t){if(this.__.__complex){const{fill:s,stroke:i,__drawAfterFill:o,__blendLayer:r}=this.__;let n;if(r&&(n=e,e=e.getSameCanvas(!0)),this.__drawRenderPath(e),this.__.__useEffect){const a=$.shape(this,e,t),{shadow:l,innerShadow:c}=this.__;l&&Ms.shadow(this,e,a),s&&(this.__.__isFills?$.fills(this,e,s):$.fill(this,e,s)),o&&this.__drawAfterFill(e,t),c&&Ms.innerShadow(this,e,a),i&&(this.__.__isStrokes?$.strokes(this,e,i):$.stroke(this,e,i)),a.worldCanvas&&a.worldCanvas.recycle(),a.canvas.recycle()}else s&&(this.__.__isFills?$.fills(this,e,s):$.fill(this,e,s)),o&&this.__drawAfterFill(e,t),i&&(this.__.__isStrokes?$.strokes(this,e,i):$.stroke(this,e,i));n&&(n.copyWorldToInner(e,this.__world,this.__layout.renderBounds,this.__.blendMode),e.recycle())}else this.__drawFast(e,t)},__renderShape(e,t){if(!this.__worldOpacity)return;e.setWorld(this.__world,t.matrix);const{fill:s,stroke:i}=this.__;this.__drawRenderPath(e),s&&$.fill(this,e,"#000000"),i&&$.stroke(this,e,"#000000")}},Qr={__drawFast(e,t){const{width:s,height:i,fill:o,stroke:r,__drawAfterFill:n}=this.__;if(o&&(e.fillStyle=o,e.fillRect(0,0,s,i)),n&&this.__drawAfterFill(e,t),r){const{strokeAlign:a,strokeWidth:l}=this.__;e.setStroke(r,l,this.__);const c=l/2;switch(a){case"center":e.strokeRect(0,0,s,i);break;case"inside":e.strokeRect(c,c,s-l,i-l);break;case"outside":e.strokeRect(-c,-c,s+l,i+l)}}}};let E=class extends os{constructor(e){super(e)}set(e){Object.assign(this,e)}get(){return this.__.__getInputData()}getPath(e){const t=this.__.path;return t?e?de.toCanvasData(t,!0):t:[]}getPathString(e){return de.stringify(this.getPath(e))}__onUpdateSize(){if(this.__.__input){const{fill:e,stroke:t}=this.__.__input;e&&$.computeFill(this),t&&$.computeStroke(this)}}__updateRenderPath(){if(this.__.path){const{__:e}=this;e.__pathForRender=e.cornerRadius?Fr.smooth(e.path,e.cornerRadius,e.cornerSmoothing):e.path}}__drawRenderPath(e){e.beginPath(),this.__drawPathByData(e,this.__.__pathForRender)}__drawPath(e){e.beginPath(),this.__drawPathByData(e,this.__.path)}__drawPathByData(e,t){}static one(e,t,s,i,o){return Fs.get(e.tag||this.prototype.__tag,e,t,s,i,o)}};d([it(Jt)],E.prototype,"__",void 0),d([Se("")],E.prototype,"id",void 0),d([Se("")],E.prototype,"name",void 0),d([Se("")],E.prototype,"className",void 0),d([Ei("pass-through")],E.prototype,"blendMode",void 0),d([Ci(1)],E.prototype,"opacity",void 0),d([Ci(!0)],E.prototype,"visible",void 0),d([Cr(!1)],E.prototype,"isMask",void 0),d([Er(0)],E.prototype,"zIndex",void 0),d([Se()],E.prototype,"locked",void 0),d([bi(0)],E.prototype,"x",void 0),d([bi(0)],E.prototype,"y",void 0),d([Y(100)],E.prototype,"width",void 0),d([Y(100)],E.prototype,"height",void 0),d([Bi(1)],E.prototype,"scaleX",void 0),d([Bi(1)],E.prototype,"scaleY",void 0),d([Ts(0)],E.prototype,"rotation",void 0),d([Ts(0)],E.prototype,"skewX",void 0),d([Ts(0)],E.prototype,"skewY",void 0),d([Se(!1)],E.prototype,"draggable",void 0),d([Ie(!0)],E.prototype,"hittable",void 0),d([Ie("path")],E.prototype,"hitFill",void 0),d([Pt("path")],E.prototype,"hitStroke",void 0),d([Ie(!0)],E.prototype,"hitChildren",void 0),d([Ie(!0)],E.prototype,"hitSelf",void 0),d([Ei()],E.prototype,"fill",void 0),d([Pt()],E.prototype,"stroke",void 0),d([Pt("inside")],E.prototype,"strokeAlign",void 0),d([Pt(1)],E.prototype,"strokeWidth",void 0),d([Pt("none")],E.prototype,"strokeCap",void 0),d([Pt("miter")],E.prototype,"strokeJoin",void 0),d([Pt()],E.prototype,"dashPattern",void 0),d([Pt()],E.prototype,"dashOffset",void 0),d([Pt(10)],E.prototype,"miterLimit",void 0),d([Ct()],E.prototype,"cornerRadius",void 0),d([Ct()],E.prototype,"cornerSmoothing",void 0),d([De()],E.prototype,"shadow",void 0),d([De()],E.prototype,"innerShadow",void 0),d([De()],E.prototype,"blur",void 0),d([De()],E.prototype,"backgroundBlur",void 0),d([De()],E.prototype,"grayscale",void 0),d([bt(Wr.drawPathByData)],E.prototype,"__drawPathByData",null),E=d([dt(qr),dt(Kr),dt($r),Hi()],E);let At=class extends E{get __tag(){return"Group"}set mask(e){this.__hasMask&&this.__removeMask(),e&&(e.isMask=!0,this.addAt(e,0))}get mask(){return this.children.find(e=>e.isMask)}constructor(e){super(e),this.isBranch=!0,this.children=[]}addAt(e,t){this.add(e,t)}addAfter(e,t){this.add(e,this.children.indexOf(t)+1)}addBefore(e,t){this.add(e,this.children.indexOf(t))}add(e,t){}remove(e){}};d([it(zs)],At.prototype,"__",void 0),At=d([dt(Os),ot()],At);let ye=class extends E{get __tag(){return"Rect"}constructor(e){super(e)}__drawPathByData(e,t){const{width:s,height:i,cornerRadius:o}=this.__;o?e.roundRect(0,0,s,i,o):e.rect(0,0,s,i)}};d([it(Vr)],ye.prototype,"__",void 0),ye=d([dt(Qr),ot()],ye);const ie=ye.prototype,yl=At.prototype,ir={},{copy:ml,add:vl}=R;let rt=class extends At{get __tag(){return"Box"}constructor(e){super(e),this.isBranchLeaf=!0,this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){let e=this.__updateRectRenderSpread()||super.__updateRenderSpread();return this.__.__drawAfterFill=this.__.overflow==="hide",e||(e=this.__.__drawAfterFill?0:1),e}__updateBoxBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){if(this.__updateRectRenderBounds(),!this.__.__drawAfterFill){const{renderBounds:e}=this.__layout;ml(ir,e),super.__updateRenderBounds(),vl(e,ir)}}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__drawPathByData(e,t){}__renderRect(e,t){}__renderGroup(e,t){}__render(e,t){this.__.__drawAfterFill?this.__renderRect(e,t):(this.__renderRect(e,t),this.__renderGroup(e,t))}__drawAfterFill(e,t){e.save(),e.clip(),this.__renderGroup(e,t),e.restore(),this.__.stroke&&this.__drawRenderPath(e)}};d([it(Xr)],rt.prototype,"__",void 0),d([ji("show")],rt.prototype,"overflow",void 0),d([bt(ie.__updateStrokeSpread)],rt.prototype,"__updateStrokeSpread",null),d([bt(ie.__updateRenderSpread)],rt.prototype,"__updateRectRenderSpread",null),d([bt(ie.__updateBoxBounds)],rt.prototype,"__updateBoxBounds",null),d([bt(ie.__updateStrokeBounds)],rt.prototype,"__updateStrokeBounds",null),d([bt(ie.__updateRenderBounds)],rt.prototype,"__updateRectRenderBounds",null),d([bt(ie.__updateChange)],rt.prototype,"__updateRectChange",null),d([bt(ie.__drawPathByData)],rt.prototype,"__drawPathByData",null),d([bt(ie.__render)],rt.prototype,"__renderRect",null),d([bt(yl.__render)],rt.prototype,"__renderGroup",null),rt=d([Hi(),ot()],rt);let Ze=class extends rt{get __tag(){return"Frame"}constructor(e){super(e),this.__.fill||(this.__.fill="#FFFFFF")}};d([it(class extends Xr{})],Ze.prototype,"__",void 0),d([ji("hide")],Ze.prototype,"overflow",void 0),Ze=d([ot()],Ze);const{moveTo:or,closePath:rr,ellipse:Pe}=xe;let Vt=class extends E{get __tag(){return"Ellipse"}constructor(e){super(e)}__updatePath(){const{width:e,height:t,innerRadius:s,startAngle:i,endAngle:o}=this.__,r=e/2,n=t/2,a=this.__.path=[];s?i||o?(s<1&&Pe(a,r,n,r*s,n*s,0,i,o,!1),Pe(a,r,n,r,n,0,o,i,!0),s<1&&rr(a)):(s<1&&(Pe(a,r,n,r*s,n*s),or(a,e,n)),Pe(a,r,n,r,n,0,0,360,!0)):i||o?(or(a,r,n),Pe(a,r,n,r,n,0,i,o,!1),rr(a)):Pe(a,r,n,r,n)}};d([it(class extends Jt{get __boxStroke(){return!0}})],Vt.prototype,"__",void 0),d([Ct(0)],Vt.prototype,"innerRadius",void 0),d([Ct(0)],Vt.prototype,"startAngle",void 0),d([Ct(0)],Vt.prototype,"endAngle",void 0),Vt=d([ot()],Vt);const{sin:wl,cos:xl,PI:nr}=Math,{moveTo:bl,lineTo:Bl,closePath:El}=xe;let Je=class extends E{get __tag(){return"Polygon"}constructor(e){super(e)}__updatePath(){const{width:e,height:t,sides:s}=this.__,i=e/2,o=t/2,r=this.__.path=[];bl(r,i,0);for(let n=1;n<s;n++)Bl(r,i+i*wl(2*n*nr/s),o-o*xl(2*n*nr/s));El(r)}};d([it(class extends Jt{})],Je.prototype,"__",void 0),d([Ct(3)],Je.prototype,"sides",void 0),Je=d([ot()],Je);const{sin:Cl,cos:Tl,PI:ar}=Math,{moveTo:kl,lineTo:Rl,closePath:Pl}=xe;let Ae=class extends E{get __tag(){return"Star"}constructor(e){super(e)}__updatePath(){const{width:e,height:t,points:s,innerRadius:i}=this.__,o=e/2,r=t/2,n=this.__.path=[];kl(n,o,0);for(let a=1;a<2*s;a++)Rl(n,o+(a%2==0?o:o*i)*Cl(a*ar/s),r-(a%2==0?r:r*i)*Tl(a*ar/s));Pl(n)}};d([it(class extends Jt{})],Ae.prototype,"__",void 0),d([Ct(5)],Ae.prototype,"points",void 0),d([Ct(.382)],Ae.prototype,"innerRadius",void 0),Ae=d([ot()],Ae);const{moveTo:Ol,lineTo:Ll}=xe,{rotate:Sl,getAngle:Ml,getDistance:Dl,defaultPoint:hr}=L,{setPoint:Al,addPoint:Il,toBounds:Nl}=Mt,fi={};let re=class extends E{get __tag(){return"Line"}get toPoint(){if(this.__toPoint&&!this.__layout.boxChanged)return this.__toPoint;const{width:e,rotation:t}=this.__,s={x:0,y:0};return e&&(s.x=e),t&&Sl(s,t),this.__toPoint=s,s}set toPoint(e){this.width=Dl(hr,e),this.rotation=Ml(hr,e),this.height&&(this.height=0)}constructor(e){super(e)}__updatePath(){const e=this.__.path=[];Ol(e,0,0);const t=this.toPoint;Ll(e,t.x,t.y)}__updateBoxBounds(){Al(fi,0,0),Il(fi,this.__toPoint.x,this.__toPoint.y),Nl(fi,this.__layout.boxBounds)}};d([it(class extends Jt{})],re.prototype,"__",void 0),d([Y()],re.prototype,"rotation",void 0),d([ds("center")],re.prototype,"strokeAlign",void 0),re=d([ot()],re);let ts=class extends ye{get __tag(){return"Image"}get ready(){return!!this.image&&this.image.ready}constructor(e){super(e)}__updateBoxBounds(){let e;const{url:t}=this,s=this.fill;s?s.url!==t&&(e=!0):t&&(e=!0),e&&(this.image&&(this.image=null),this.fill={type:"image",mode:"strench",url:t},this.once(ne.LOADED,i=>this.image=i.image)),super.__updateBoxBounds()}destroy(){this.image=null,super.destroy()}};d([it(Gr)],ts.prototype,"__",void 0),d([Y("")],ts.prototype,"url",void 0),ts=d([ot()],ts);let Xt=class extends ye{get __tag(){return"Canvas"}constructor(e){super(e),this.canvas=Z.canvas(this.__),this.context=this.canvas.context,this.__.__drawAfterFill=!0}draw(e,t,s,i){e.__layout.checkUpdate();const o=new le(e.__world);o.invert();const r=new le;t&&r.translate(t.x,t.y),s&&(typeof s=="number"?r.scale(s):r.scale(s.x,s.y)),i&&r.rotate(i),o.preMultiply(r),e.__render(this.canvas,{matrix:o}),this.paint()}paint(){this.forceUpdate("fill")}__drawAfterFill(e,t){const s=this.canvas.view,{width:i,height:o}=this;this.__.cornerRadius?(e.save(),e.clip(),e.drawImage(this.canvas.view,0,0,s.width,s.height,0,0,i,o),e.restore()):e.drawImage(this.canvas.view,0,0,s.width,s.height,0,0,i,o)}__updateSize(){const{canvas:e}=this;if(e){const{smooth:t}=this.__;e.smooth!==t&&(e.smooth=t),e.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null,this.context=null),super.destroy()}};d([it(Gr)],Xt.prototype,"__",void 0),d([Qe(100)],Xt.prototype,"width",void 0),d([Qe(100)],Xt.prototype,"height",void 0),d([Qe(A.devicePixelRatio)],Xt.prototype,"pixelRatio",void 0),d([Qe(!0)],Xt.prototype,"smooth",void 0),d([Ie("all")],Xt.prototype,"hitFill",void 0),Xt=d([ot()],Xt);const Zr=`>)]}%!?,.:;'"》）」〉』〗】〕｝┐＞’“！？，、。：；‰`,Wl=Zr+"_#~&*+\\=|≮≯≈≠＝…";function us(e){const t={};return e.split("").forEach(s=>t[s]=!0),t}const Fl=us("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),zl=us(`{[(<'"《（「〈『〖【〔｛┌＜’“＝¥￥＄€£￡¢￠`),jl=us(Zr),Yl=us(Wl),Hl=us("- —／～｜┆·");var Ds;(function(e){e[e.Letter=0]="Letter",e[e.Single=1]="Single",e[e.Before=2]="Before",e[e.After=3]="After",e[e.Symbol=4]="Symbol",e[e.Break=5]="Break"})(Ds||(Ds={}));const{Letter:lr,Single:Ul,Before:Xl,After:Vl,Symbol:Gl,Break:ql}=Ds;function Kl(e){return Fl[e]?lr:Hl[e]?ql:/[\u3400-\u9FBF]/.test(e)?Ul:zl[e]?Xl:jl[e]?Vl:Yl[e]?Gl:lr}const $l={trimRight(e){const{words:t}=e;let s,i=0,o=t.length;for(let r=o-1;r>-1&&(s=t[r].data[0],s.char===" ");r--)i++,e.width-=s.width;i&&t.splice(o-i,i)}};function Ql(e,t,s){switch(t){case"title":return s?e.toUpperCase():e;case"upper":return e.toUpperCase();case"lower":return e.toLowerCase();default:return e}}const{trimRight:Zl}=$l,{Letter:yi,Single:qe,Before:dr,After:mi,Symbol:Jl,Break:cr}=Ds;let ss,Ot,lt,fe,vi,xt,pe,mt,oe,wi,Ke,is,Si,As,es=[];function xi(e,t){ss.data.push({char:e,width:t}),lt+=t}function Oe(){fe+=lt,ss.width=lt,Ot.words.push(ss),ss={data:[]},lt=0}function Cs(){is&&(Si.paraNumber++,Ot.paraStart=!0,is=!1),Ot.width=fe,Zl(Ot),es.push(Ot),Ot.width>As.width&&(As.width=Ot.width),Ot={words:[]},fe=0}const td=0,ur=1,pr=2,ed={getDrawData(e,t){typeof e!="string"&&(e=String(e));let s=0,i=0,{width:o,height:r,padding:n}=t;const{textDecoration:a,textOverflow:l,__font:c}=t;if(o||(o=0),n){const[h,_,p,m]=Fe.fourNumber(n);o&&(s=m,o-=_+m),r&&(i=h,r-=h+p)}const u={bounds:{x:s,y:i,width:o,height:r},rows:[],paraNumber:0,font:A.canvas.font=c};return function(h,_,p){Si=h,es=h.rows,As=h.bounds;const{__letterSpacing:m,paraIndent:g,textCase:v}=p,{canvas:f}=A,{width:y,height:w}=As;if(y||w||m||v){is=!0,oe=null,lt=fe=0,ss={data:[]},Ot={words:[]};for(let x=0,B=_.length;x<B;x++)xt=_[x],xt===`
`?(lt&&Oe(),Ot.paraEnd=!0,Cs(),is=!0):(mt=Kl(xt),mt===yi&&v!=="none"&&(xt=Ql(xt,v,!lt)),pe=f.measureText(xt).width,m&&(pe+=m),wi=mt===qe&&(oe===qe||oe===yi)||oe===qe&&mt!==mi,Ke=!(mt!==dr&&mt!==qe||oe!==Jl&&oe!==mi),vi=is&&g?y-g:y,y&&fe+lt+pe>vi&&(Ke||(Ke=mt===yi&&oe==mi),(wi||Ke||mt===cr||mt===dr||mt===qe||lt+pe>vi)&&lt&&Oe(),Cs()),xt===" "&&fe+lt===0||(mt===cr?(xt===" "&&lt&&Oe(),xi(xt,pe),Oe()):((wi||Ke)&&lt&&Oe(),xi(xt,pe))),oe=mt);lt&&Oe(),fe&&Cs(),es[es.length-1].paraEnd=!0}else _.split(`
`).forEach(x=>{Si.paraNumber++,es.push({x:g||0,text:x,width:f.measureText(x).width,paraStart:!0})})}(u,e,t),function(h,_){const{rows:p,bounds:m}=h,{__lineHeight:g,__baseLine:v,textAlign:f,verticalAlign:y,paraSpacing:w,textOverflow:x}=_;let B,{x:k,y:P,width:T,height:D}=m,N=g*p.length+(w?w*(h.paraNumber-1):0),H=v;if(D){if(x!=="show"&&N>D)N=Math.max(D,g),h.overflow=p.length;else switch(y){case"middle":P+=(D-N)/2;break;case"bottom":P+=D-N}H+=P}for(let U=0,Q=p.length;U<Q;U++){switch(B=p[U],B.x=k,f){case"center":B.x+=(T-B.width)/2;break;case"right":B.x+=T-B.width}B.paraStart&&w&&U>0&&(H+=w),B.y=H,H+=g,h.overflow>U&&H>N&&(B.isOverflow=!0,h.overflow=U+1)}m.y=P,m.height=N}(u,t),function(h,_,p,m){const{rows:g}=h,{textAlign:v,paraIndent:f,letterSpacing:y}=_;let w,x,B,k,P;g.forEach(T=>{T.words&&(B=f&&T.paraStart?f:0,x=p&&v==="justify"&&T.words.length>1?(p-T.width-B)/(T.words.length-1):0,k=y||T.isOverflow?td:x>.01?ur:pr,k===pr?(T.text="",T.x+=B,T.words.forEach(D=>{D.data.forEach(N=>{T.text+=N.char})})):(T.x+=B,w=T.x,T.data=[],T.words.forEach(D=>{k===ur?(P={char:"",x:w},w=function(N,H,U){return N.forEach(Q=>{U.char+=Q.char,H+=Q.width}),H}(D.data,w,P),P.char!==" "&&T.data.push(P)):w=function(N,H,U){return N.forEach(Q=>{Q.char!==" "&&(Q.x=H,U.push(Q)),H+=Q.width}),H}(D.data,w,T.data),!T.paraEnd&&x&&(w+=x,T.width+=x)})),T.words=null)})}(u,t,o),u.overflow&&function(h,_){const{rows:p,overflow:m}=h;if(p.splice(m),_!=="hide"){_==="ellipsis"&&(_="...");const g=A.canvas.measureText(_).width,v=p[m-1];let f,y,w=v.data.length-1;const{x,width:B}=h.bounds,k=x+B-g;for(let P=w;P>-1&&(f=v.data[P],y=f.x+f.width,!(P===w&&y<k));P--){if(y<k&&f.char!==" "){v.data.splice(P+1),v.width-=f.width;break}v.width-=f.width}v.width+=g,v.data.push({char:_,x:y})}}(u,l),a!=="none"&&function(h,_){const{fontSize:p}=_;switch(h.decorationHeight=p/11,_.textDecoration){case"under":h.decorationY=.15*p;break;case"delete":h.decorationY=.35*-p}}(u,t),u}},{copyAndSpread:sd,includes:id,spread:od}=R;let W=class extends E{get __tag(){return"Text"}get textDrawData(){return this.__layout.checkUpdate(),this.__.__textDrawData}constructor(e){super(e)}__drawHitPath(e){const{__lineHeight:t,__baseLine:s,__textDrawData:i}=this.__;e.beginPath(),i.rows.forEach(o=>e.rect(o.x,o.y-s,o.width,t))}__drawPathByData(e,t){const{x:s,y:i,width:o,height:r}=this.__layout.boxBounds;e.rect(s,i,o,r)}__drawRenderPath(e){e.font=this.__.__font}__updateTextDrawData(){const e=this.__;e.__textDrawData=ed.getDrawData(e.text,this.__)}__updateBoxBounds(){const e=this.__,t=this.__layout,{width:s,height:i,lineHeight:o,letterSpacing:r,fontFamily:n,fontSize:a,fontWeight:l,italic:c,textCase:u}=e;e.__lineHeight=sr.number(o,a),e.__letterSpacing=sr.number(r,a),e.__baseLine=e.__lineHeight-(e.__lineHeight-.7*a)/2,e.__font=`${c?"italic ":""}${u==="small-caps"?"small-caps ":""}${l!=="normal"?l+" ":""}${a}px ${n}`,this.__updateTextDrawData();const{bounds:h}=e.__textDrawData,_=t.boxBounds;e.__lineHeight<a&&od(h,a/2),s&&i?super.__updateBoxBounds():(_.x=s?0:h.x,_.y=i?0:h.y,_.width=s||h.width,_.height=i||h.height);const p=id(_,h)?_:h;p!==t.contentBounds&&(t.contentBounds=p,t.renderChanged=!0)}__updateRenderSpread(){let e=super.__updateRenderSpread();return e||(e=this.__layout.boxBounds===this.__layout.contentBounds?0:1),e}__updateRenderBounds(){sd(this.__layout.renderBounds,this.__layout.contentBounds,this.__layout.renderSpread)}};d([it(class extends Jt{setFontWeight(e){typeof e=="string"?(this.__setInput("fontWeight",e),this._fontWeight=fl[e]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=e)}})],W.prototype,"__",void 0),d([Y(0)],W.prototype,"width",void 0),d([Y(0)],W.prototype,"height",void 0),d([Y(0)],W.prototype,"padding",void 0),d([ds("outside")],W.prototype,"strokeAlign",void 0),d([Y("")],W.prototype,"text",void 0),d([Y("L")],W.prototype,"fontFamily",void 0),d([Y(12)],W.prototype,"fontSize",void 0),d([Y("normal")],W.prototype,"fontWeight",void 0),d([Y(!1)],W.prototype,"italic",void 0),d([Y("none")],W.prototype,"textCase",void 0),d([Y("none")],W.prototype,"textDecoration",void 0),d([Y(0)],W.prototype,"letterSpacing",void 0),d([Y({type:"percent",value:150})],W.prototype,"lineHeight",void 0),d([Y(0)],W.prototype,"paraIndent",void 0),d([Y(0)],W.prototype,"paraSpacing",void 0),d([Y("left")],W.prototype,"textAlign",void 0),d([Y("top")],W.prototype,"verticalAlign",void 0),d([Y("show")],W.prototype,"textOverflow",void 0),W=d([ot()],W);const{toBounds:rd}=Ki;let Gt=class extends E{get __tag(){return"Path"}constructor(e){super(e)}__updateBoxBounds(){rd(this.__.path,this.__layout.boxBounds)}};d([it(class extends Jt{setPath(e){typeof e=="string"?(this.__setInput("path",e),this._path=gl(e)):(this.__input&&this.__removeInput("path"),this._path=e)}})],Gt.prototype,"__",void 0),d([Ct()],Gt.prototype,"path",void 0),d([Ct()],Gt.prototype,"windingRule",void 0),d([ds("center")],Gt.prototype,"strokeAlign",void 0),Gt=d([ot()],Gt);let Ps=class extends At{get __tag(){return"Pen"}constructor(e){super(e)}setStyle(e){const t=this.pathElement=new Gt(e);return this.pathStyle=e,this.path=t.path||(t.path=[]),this.add(t),this}beginPath(){return this.path.length=0,this.paint(),this}moveTo(e,t){return this}lineTo(e,t){return this}bezierCurveTo(e,t,s,i,o,r){return this}quadraticCurveTo(e,t,s,i){return this}closePath(){return this}rect(e,t,s,i){return this}roundRect(e,t,s,i,o){return this}ellipse(e,t,s,i,o,r,n,a){return this}arc(e,t,s,i,o,r){return this}arcTo(e,t,s,i,o){return this}moveToEllipse(e,t,s,i,o,r,n,a){return this}moveToArc(e,t,s,i,o,r){return this}paint(){this.pathElement.forceUpdate("path")}};d([it(class extends zs{})],Ps.prototype,"__",void 0),Ps=d([dt(qi,["beginPath"]),ot()],Ps);const nd=F.get("Leafer");let ae=class extends At{get __tag(){return"Leafer"}get isApp(){return!1}constructor(e,t){super(t),this.zoomLayer=this,this.moveLayer=this,this.config={type:"design",start:!0,hittable:!0,zoom:{min:.02,max:256},move:{dragOut:!0,autoDistance:2}},this.__eventIds=[],this.__controllers=[],this.userConfig=e,e!=null&&e.view&&this.init(e)}init(e,t){if(this.canvas)return;let s;this.__setLeafer(this),e&&et.assign(this.config,e);const{config:i}=this;We.run(i.type,this),this.canvas=Z.canvas(i),this.__controllers.push(this.renderer=Z.renderer(this,this.canvas,i),this.watcher=Z.watcher(this,i),this.layouter=Z.layouter(this,i)),this.isApp&&this.__setApp(),this.__checkAutoLayout(i),this.view=this.canvas.view,t?(this.__bindApp(t),s=t.running):(this.selector=Z.selector(this),this.__controllers.unshift(this.interaction=Z.interaction(this,this.canvas,this.selector,i)),this.canvasManager=new Fi,this.hitCanvasManager=new xr,this.imageManager=new Dr(this,i),s=i.start),this.hittable=i.hittable,this.fill=i.fill,this.canvasManager.add(this.canvas),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this)))}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.ready?this.emitLeafer(q.RESTART):this.emitLeafer(q.START),this.__controllers.forEach(e=>e.start()),this.isApp||this.renderer.render(),this.running=!0)}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(e=>e.stop()),this.running=!1,this.emitLeafer(q.STOP))}resize(e){const t=et.copyAttrs({},e,Lt);Object.keys(t).forEach(s=>this[s]=t[s])}forceFullRender(){this.renderer.addBlock(this.canvas.bounds),this.viewReady&&this.renderer.update()}__doResize(e){if(!this.canvas||this.canvas.isSameSize(e))return;const t=et.copyAttrs({},this.canvas,Lt);this.canvas.resize(e),this.__onResize(new ce(e,t))}__onResize(e){this.emitEvent(e),et.copyAttrs(this.__,e,Lt),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(e){this.selector=e.selector,this.interaction=e.interaction,this.canvasManager=e.canvasManager,this.hitCanvasManager=e.hitCanvasManager,this.imageManager=e.imageManager}__setLeafer(e){this.leafer=e,this.isLeafer=!!e,this.__level=1}setZoomLayer(e,t){this.zoomLayer=e,this.moveLayer=t||e}__checkAutoLayout(e){e.width&&e.height||(this.autoLayout=new mr(e),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(e,t){this.canvas&&(Lt.includes(e)?this.__changeCanvasSize(e,t):e==="fill"?this.__changeFill(t):e==="hittable"&&this.canvas.setHittable(t)),super.__setAttr(e,t)}__getAttr(e){return this.canvas&&Lt.includes(e)?this.canvas[e]:super.__getAttr(e)}__changeCanvasSize(e,t){const s=et.copyAttrs({},this.canvas,Lt);s[e]=this.config[e]=t,t&&this.canvas.stopAutoLayout(),this.__doResize(s)}__changeFill(e){this.config.fill=e,this.canvas.allowBackgroundColor?this.canvas.setBackgroundColor(e):this.forceFullRender()}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(q.BEFORE_READY),this.emitLeafer(q.READY),this.emitLeafer(q.AFTER_READY))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(q.VIEW_READY))}__checkUpdateLayout(){this.__layout.checkUpdate()}emitLeafer(e){this.emitEvent(new q(e,this))}__listenEvents(){const e=nt.start("FirstCreate "+this.innerName);this.once(q.START,()=>nt.end(e)),this.once(I.END,()=>this.__onReady()),this.once(K.END,()=>this.__onViewReady()),this.on(I.CHECK_UPDATE,()=>this.__checkUpdateLayout())}__removeListenEvents(){this.off_(this.__eventIds)}destory(){if(this.canvas)try{this.stop(),this.emitEvent(new q(q.END,this)),this.__removeListenEvents(),this.__controllers.forEach(e=>e.destroy()),this.__controllers.length=0,this.selector.destroy(),this.canvasManager.destory(),this.hitCanvasManager.destory(),this.imageManager.destory(),this.canvas.destroy(),this.canvas=null,this.config=this.userConfig=this.view=null,super.destroy()}catch(e){nd.error(e)}}};d([it(class extends zs{})],ae.prototype,"__",void 0),d([Y()],ae.prototype,"pixelRatio",void 0),ae=d([ot()],ae);let Mi=class extends ae{constructor(){super(...arguments),this.children=[]}get __tag(){return"App"}get isApp(){return!0}__setApp(){const{canvas:e}=this,{realCanvas:t,view:s}=this.config;t||s===this.canvas.view||!e.parentView?this.realCanvas=!0:e.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(Ne.CHANGE,()=>{F.showHitView&&this.children.forEach(i=>{i.forceUpdate("blendMode")})}))}start(){super.start(),this.children.forEach(e=>{e.start()})}stop(){this.children.forEach(e=>{e.stop()}),super.stop()}addLeafer(e){const t=new ae(e);return this.add(t),t}add(e){e.view||e.init(this.__getChildConfig(e.userConfig),this),super.add(e),e.once(I.END,()=>{!this.ready&&this.children.every(t=>t.ready)&&this.__onReady()}),e.once(K.END,()=>{!this.viewReady&&this.children.every(t=>t.viewReady)&&this.__onViewReady()}),this.realCanvas&&this.__eventIds.push(e.on_(K.END,this.__onChildRenderEnd,this))}__onChildRenderEnd(e){this.renderer.addBlock(e.renderBounds),this.viewReady&&this.renderer.update()}__render(e,t){this.children.forEach(s=>{e.copyWorld(s.canvas)})}__onResize(e){this.children.forEach(t=>{t.resize(e)}),super.__onResize(e)}__checkUpdateLayout(){this.children.forEach(e=>{e.__layout.checkUpdate()})}__getChildConfig(e){let t=Object.assign({},this.config);return e&&et.assign(t,e),t.view=this.realCanvas?void 0:this.view,t.fill=t.hittable=t.realCanvas=void 0,this.autoLayout&&et.copyAttrs(t,this,Lt),t}destory(){this.children.forEach(e=>{e.destory()}),this.children.length=0,super.destory()}};Mi=d([ot()],Mi);var ad=Object.freeze({__proto__:null,Animate:jh,get App(){return Mi},AutoBounds:mr,BezierHelper:we,Bounds:tt,BoundsHelper:R,get Box(){return rt},get Branch(){return Os},BranchHelper:ns,get Canvas(){return Xt},CanvasManager:Fi,ChildEvent:Et,Creator:Z,DataHelper:et,Debug:F,get DragEvent(){return V},get DropEvent(){return $t},Effect:Ms,get Ellipse(){return Vt},EllipseHelper:Nr,Event:Tt,EventCreator:hs,Export:Yh,get Frame(){return Ze},get Group(){return At},HitCanvasManager:xr,get Image(){return ts},ImageEvent:ne,ImageManager:Dr,IncrementId:Qt,Interaction:Ur,get KeyEvent(){return Me},Keyboard:ve,LayoutEvent:I,Layouter:as,get Leaf(){return os},LeafBounds:Or,LeafBoundsHelper:Ii,LeafData:Wi,LeafDataProxy:Rr,LeafEventer:kr,LeafHelper:me,LeafHit:Lr,LeafLevelList:yr,LeafList:st,LeafMask:Mr,LeafMatrix:Pr,LeafRender:Sr,get Leafer(){return ae},LeaferCanvas:Ri,LeaferCanvasBase:Br,LeaferEvent:q,LeaferImage:ki,LeaferImageBase:ki,LeaferTypeCreator:We,get Line(){return re},MathHelper:Fe,Matrix:le,MatrixHelper:O,get MoveEvent(){return gt},NeedConvertToCanvasCommandMap:Ui,OneRadian:M,PI2:vt,PI_2:Le,Paint:$,get Path(){return Gt},PathBounds:Ki,PathCommandDataHelper:xe,PathCommandMap:ct,PathConvert:de,PathCorner:Fr,PathCreator:qi,PathDrawer:Wr,PathHelper:Bt,PathNumberCommandLengthMap:Vi,PathNumberCommandMap:Xi,get Pen(){return Ps},Platform:A,PluginManager:Ss,Point:Ai,PointHelper:L,PointerButton:Kt,get PointerEvent(){return C},get Polygon(){return Je},PropertyEvent:Ne,get Rect(){return ye},RectHelper:Gi,RectRender:Qr,RenderEvent:K,Renderer:jr,ResizeEvent:ce,get RotateEvent(){return qt},Run:nt,Selector:Yr,get Star(){return Ae},StringNumberMap:vr,get SwipeEvent(){return wt},TaskItem:Rs,TaskProcessor:Ph,get Text(){return W},TransformEvent:_e,TwoPointBounds:pn,TwoPointBoundsHelper:Mt,get UI(){return E},UIBounds:qr,UICreator:Fs,UIEvent:cs,UIHit:Kr,UIRender:$r,WaitHelper:Ni,WatchEvent:he,Watcher:zr,get ZoomEvent(){return St},affectRenderBoundsType:ji,affectStrokeBoundsType:ds,aliasType:Ln,boundsType:Y,canvasSizeAttrs:Lt,dataProcessor:it,dataType:Se,defineDataProcessor:Yi,defineKey:ls,defineLeafAttr:at,effectType:De,getDescriptor:zi,hitType:Ie,layoutProcessor:Sn,maskType:Cr,opacityType:Ci,pathType:Ct,positionType:bi,registerUI:ot,registerUIEvent:Zt,resizeType:Qe,rewrite:bt,rewriteAble:Hi,rotationType:Ts,scaleType:Bi,setDefaultValue:Mn,sortType:Er,strokeType:Pt,surfaceType:Ei,useModule:dt,usePlugin:kh});Ss.power=ad;const{PI:_r}=Math;function hd(e,t){return t==="degree"?e*_r/180:e*180/_r}var Is=(e=>(e[e.EasyIn=0]="EasyIn",e[e.EasyOut=1]="EasyOut",e[e.EasyInOUt=2]="EasyInOUt",e[e.QuadraticIn=3]="QuadraticIn",e[e.QuadraticOut=4]="QuadraticOut",e[e.QuadraticInOut=5]="QuadraticInOut",e[e.ElasticIn=6]="ElasticIn",e[e.ElasticOut=7]="ElasticOut",e[e.ElasticInOut=8]="ElasticInOut",e))(Is||{});function Di(e,t,s,i){function o(g,v,f){return g+(v-g)*f}function r(g,v,f){return o(g,v,f)}function n(g,v,f){return o(g,v,f)}function a(g,v,f){return o(g,v,f)}function l(g,v,f){return g+(v-g)*f*f}function c(g,v,f){return g+(v-g)*f*(2-f)}function u(g,v,f){let y=0;return(f*=2)<1?y=.5*f*f:y=-.5*(--f*(f-2)-1),g+(v-g)*y}function h(g,v,f){let y=0;return f===0&&(y=0),f===1&&(y=1),y=-Math.pow(2,10*(f-1))*Math.sin((f-1.1)*5*Math.PI),g+(v-g)*y}function _(g,v,f){let y=0;return f===0&&(y=0),f===1&&(y=1),y=Math.pow(2,-10*f)*Math.sin((f-.1)*5*Math.PI)+1,g+(v-g)*y}function p(g,v,f){let y=0;return f===0&&(y=0),f===1&&(y=1),f*=2,f<1&&(y=-.5*Math.pow(2,10*(f-1))*Math.sin((f-1.1)*5*Math.PI)),y=.5*Math.pow(2,-10*(f-1))*Math.sin((f-1.1)*5*Math.PI)+1,g+(v-g)*y}const m=new Map;return m.set(0,r),m.set(1,n),m.set(2,a),m.set(3,l),m.set(4,c),m.set(5,u),m.set(6,h),m.set(7,_),m.set(8,p),function(v){const f=m.get(e);let y=v/i;if(y=i===0||y>1?1:y,typeof t=="number"&&typeof s=="number")return f(t,s,y);if(typeof t=="object"&&typeof s=="object")return{x:f(t.x,s.x,y),y:f(t.y,s.y,y)}}}const{sin:Ns,cos:Ws,ceil:Yd,PI:Jr,abs:ld,atan:tn}=Math;function dd(e){const t=new Map;return e.forEach(s=>{t.set(s.id,s)}),t}function cd({x:e,y:t},s,i){return{x:e+s*Ns(i),y:t-s*Ws(i)}}function ud(e,t,s,i,o,r){if(t){const n=(r-1)/2,a=o-n,l=$i(a),c=Jr/(2*(r+1)),u=ld(n-o)*2;return e.theta+l*c*u}else return hd(s,"degree")+i*o}function $i(e){return e>0?1:e<0?-1:0}function pd(e,t){const{from:s,to:i}=e;let[o,r,n,a]=[0,0,0,0];if(s&&i){const{x:l,y:c}=s,{x:u,y:h}=i,_=tn((c-h)/(l-u)),p=t*Ws(_),m=t*Ns(_),g=$i(l-u);o=l-g*p,r=c-g*m,n=u+g*p,a=h+g*m}return{fx:o,fy:r,tx:n,ty:a}}function gr(e,t,s,i,o,r=Jr/6){const n=e-s===0?0:tn((i-t)/(s-e)),a=n+r,l=n-r,c=$i(e-s),u=s+c*o*Ws(a),h=i+c*o*Ns(a),_=s+c*o*Ws(l),p=i+c*o*Ns(l);return`M ${u} ${h} L ${s} ${i} L ${_} ${p} Z`}const{PI:fr}=Math;function en(e,t){const{nodeMap:s,rootId:i,options:o}=e,r=s.get(t||i),{nodes:n,lines:a}=e;n.forEach(l=>{l.show=!1}),a.forEach(l=>{l.show=!1}),gd(_d(r,o),a)}function _d(e,t){const{width:s,height:i,level:o}=t;return e?(e.endX=s/2,e.endY=i/2,sn(e,null,t,o)):[]}function sn(e,t,s,i,o=new Set){e.show=!0,o.add(e);const{startAngle:r,radius:n,defaultRadius:a,level:l}=s,c=e.toRelation.filter(m=>!o.has(m)),u=e.fromRelation.filter(m=>!o.has(m)),h=[...c,...u],_=h.length,p=t?fr/(_+1):2*fr/_;return h.forEach((m,g)=>{var v;const f=(v=n[l-i])!=null?v:a,y=ud(e,t,r,p,g,_),{x:w,y:x}=cd({x:e.endX,y:e.endY},f,y);m=Object.assign(m,{endX:w,endY:x},{theta:y}),i>0?sn(m,e,s,i-1,o):(m.show=!0,o.add(m))}),[...o]}function gd(e,t){const s=e.flatMap(i=>t.filter(o=>o.from===i));return s.forEach(i=>{i.show=!0}),s}function fd(e,t){const s=dd(e);for(const i of t){const{from:o,to:r}=i,n=s.get(o),a=s.get(r);n&&a&&(n.toRelation.push(a),a.fromRelation.push(n))}}var yd=Object.defineProperty,md=(e,t,s)=>t in e?yd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,J=(e,t,s)=>(md(e,typeof t!="symbol"?t+"":t,s),s);class vd{constructor(t,s){this.graph=s,J(this,"x",0),J(this,"y",0),J(this,"id"),J(this,"origin"),J(this,"fromRelation"),J(this,"toRelation"),J(this,"theta",0),J(this,"endX",0),J(this,"endY",0),J(this,"ellipseObj"),J(this,"show",!1),J(this,"group",new At),J(this,"textObj"),J(this,"opacity",0),J(this,"handleClick",()=>{this.graph.rootId!==this.id&&(en(this.graph,this.id),setTimeout(()=>{this.graph.update()},0))}),J(this,"handleDrag",i=>{var o;const{x:r,y:n}=i;this.endX=this.x=r,this.endY=this.y=n,this.updateText(),(o=this.graph)==null||o.updateLines(0)}),this.origin=t,this.id=t.id,this.fromRelation=[],this.toRelation=[],this.ellipseObj=new Vt({x:this.x,y:this.y}),this.textObj=new W({text:t.text||"",fill:"#f00",textAlign:"center",verticalAlign:"middle"}),this.group.add(this.ellipseObj),this.group.add(this.textObj),this.group.opacity=this.opacity,this.group.on(C.CLICK,this.handleClick)}update(t){const{group:s,show:i}=this,o=i?1:0;s.visible=i;const r=Date.now(),n={x:this.x,y:this.y},a={x:this.endX,y:this.endY},l=Di(Is.QuadraticInOut,n,a,t),c=Di(Is.QuadraticInOut,this.opacity,o,t),u=()=>{const h=Date.now()-r,{x:_,y:p}=l(h),m=c(h);this.updateEllipse(_,p),this.updateText(),this.group.opacity=m,this.opacity=m,t>0&&h<=t&&requestAnimationFrame(u)};u()}updateEllipse(t,s){const{nodeRadius:i}=this.graph.options;this.x=t,this.y=s,this.ellipseObj.set({width:i*2,height:i*2,fill:"#fff",x:t,y:s})}updateText(){const{x:t,y:s,graph:i}=this,{leafer:{scaleX:o,scaleY:r}}=i,{nodeRadius:n}=i.options,{width:a,height:l}=this.textObj.getBounds("content");this.textObj.set({x:t-a/2+n*o,y:s-l/2+n*r})}addLeafer(){const{leafer:t}=this.graph;t.add(this.group)}}var wd=Object.defineProperty,xd=(e,t,s)=>t in e?wd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Ut=(e,t,s)=>(xd(e,typeof t!="symbol"?t+"":t,s),s);class bd{constructor(t,s){this.graph=s,Ut(this,"origin"),Ut(this,"from"),Ut(this,"to"),Ut(this,"lineObj"),Ut(this,"show",!1),Ut(this,"group",new At),Ut(this,"textObj"),Ut(this,"arrowObj"),Ut(this,"opacity",0);const{nodeMap:i,options:o}=s,{lineColor:r}=o;this.origin=t;const{to:n,from:a}=t;this.from=i.get(a),this.to=i.get(n),this.lineObj=new re({stroke:r,strokeWidth:1,opacity:this.opacity}),this.textObj=new W({text:t.text||"",fill:r,textAlign:"center",verticalAlign:"middle"}),this.arrowObj=new Gt({fill:r}),this.group.add(this.lineObj),this.group.add(this.textObj),this.group.add(this.arrowObj)}update(t){var s,i;const{graph:o}=this,{nodeRadius:r}=o.options,n=((s=this.from)==null?void 0:s.show)&&((i=this.to)==null?void 0:i.show);this.group.visible=n||!1;const a=n?1:0;if(!n){this.opacity=a;return}const l=Date.now(),c=Di(Is.QuadraticInOut,this.opacity,a,t),u=()=>{const h=Date.now()-l,_=c(h),{fx:p,fy:m,tx:g,ty:v}=pd(this,r),[f,y,w,x]=[p,m,g,v].map(B=>B+r);this.updateLine(f,y,w,x,_||0),this.updateText(f,y,w,x,_||0),this.updateArrow(f,y,w,x,_||0),this.opacity=a,h<=t&&requestAnimationFrame(u)};u()}updateLine(t,s,i,o,r){this.lineObj.set({toPoint:{x:i-t,y:o-s},x:t,y:s,opacity:r})}updateText(t,s,i,o,r){const{width:n,height:a}=this.textObj.getBounds("content");this.textObj.set({x:(t+i-n)/2,y:(s+o-a)/2,opacity:r})}updateArrow(t,s,i,o,r){const{arrowLength:n}=this.graph.options,a=gr(t,s,i,o,n);this.arrowObj.set({path:a,opacity:r})}arrowPath(){const{from:t,to:s}=this;if(t&&s){const{arrowLength:i}=this.graph.options;return gr(t.x,t.y,s.x,s.y,i)}return""}addLeader(){const{leafer:t}=this.graph;t.add(this.group)}}const Bd={height:500,width:500,color:"#fff",lineColor:"#fff",nodeRadius:20,borderColor:"#000",level:3,startAngle:30,radius:[180,160,140,120],defaultRadius:40,showLineText:!0,fontSize:16,duration:2e3,arrowLength:10};var Ed=Object.defineProperty,Cd=(e,t,s)=>t in e?Ed(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,$e=(e,t,s)=>(Cd(e,typeof t!="symbol"?t+"":t,s),s);class Td{constructor(t,s={},i=[],o=[]){$e(this,"options"),$e(this,"el"),$e(this,"nodes",[]),$e(this,"lines",[]),$e(this,"nodeMap",new Map);var r;if(typeof t=="string"&&(t=document.querySelector(t)),this.el=t,!((r=this.el)!=null&&r.getContext))throw console.warn("传入的id不对,或者不是canvas元素"),new Error("传入的id不对,或者不是canvas元素");this.options=Object.assign(Bd,s),this.initData(i,o)}initLines(t){t.forEach(s=>{this.lines.push(new bd(s,this))})}initNodes(t){t.forEach(s=>{const i=new vd(s,this);this.nodes.push(i),this.nodeMap.set(s.id,i)})}initData(t,s){this.initNodes(s),this.initLines(t)}}var kd=Object.defineProperty,Rd=(e,t,s)=>t in e?kd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Pd=(e,t,s)=>(Rd(e,typeof t!="symbol"?t+"":t,s),s);class Od extends Td{constructor(t,s={}){super(t,s),Pd(this,"leafer");const{width:i,height:o}=this.options;this.leafer=new ae({view:this.el,width:i,height:o,start:!0,zoom:{max:4,min:.5}})}addLeafer(){this.nodes.forEach(t=>t.addLeafer()),this.lines.forEach(t=>t.addLeader())}update(t){const{duration:s}=this.options;this.updateNodes(t??s),this.updateLines(t??s)}updateNodes(t){this.nodes.forEach(s=>s.update(t))}updateLines(t){this.lines.forEach(s=>s.update(t))}}var Ld=Object.defineProperty,Sd=(e,t,s)=>t in e?Ld(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Md=(e,t,s)=>(Sd(e,typeof t!="symbol"?t+"":t,s),s);class Dd extends Od{constructor(t,s={}){super(t,s),Md(this,"subEvent",new Map),this.addEvent()}on(t,s){const i=this.subEvent.get(t);i?i.push(s):this.subEvent.set(t,[s])}emit(t,s){(this.subEvent.get(t)||[]).forEach(o=>o(s))}addEvent(){this.leafer}}class Ad extends Dd{constructor(t,s={}){super(t,s)}drawNode(){const{nodeRadius:t,color:s}=this.options,i=this.nodes.filter(o=>o.show);for(const{x:o,y:r,origin:{text:n}}of i){const a=new Vt({x:o,y:r,width:t,height:t,fill:s});this.leafer.add(a),this.drawText(n,o,r)}}drawLine(){const{lineColor:t,showLineText:s}=this.options,i=this.lines.filter(o=>o.show);for(const o of i){const{from:r,to:n}=o;if(r&&n){const{x:a,y:l}=r,{x:c,y:u}=n,h=new re({x:a,y:l,stroke:t});h.toPoint={x:c,y:u},this.leafer.add(h),s&&this.drawLineText(o)}}}drawText(t,s,i){const o=new W({text:t,x:s,y:i,fill:"#ff"});this.leafer.add(o)}drawLineText(t){const{from:s,to:i,origin:{text:o}}=t;if(o){const{x:r,y:n}=s,{x:a,y:l}=i,c=(r+a)/2,u=(n+l)/2,h=new W({text:o,x:c,y:u,fill:"#fff"});this.leafer.add(h)}}}var Id=Object.defineProperty,Nd=(e,t,s)=>t in e?Id(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Wd=(e,t,s)=>(Nd(e,typeof t!="symbol"?t+"":t,s),s);class Fd extends Ad{constructor(t,s={}){super(t,s),Wd(this,"rootId")}draw(t,s,i){this.rootId=t,i&&this.initNodes(i),s&&this.initLines(s),this.render(t)}render(t){fd(this.nodes,this.lines.map(s=>s.origin)),this.addLeafer(),this.leafer.on(q.READY,()=>{en(this,t),this.update()})}}class zd extends Fd{constructor(t,s={}){super(t,s)}}function jd(e){const t=[{id:"N1",text:"侯亮平",color:"#ec6941",borderColor:"#ff875e"},{id:"N2",text:"李达康",color:"#ec6941",borderColor:"#ff875e"},{id:"N3",text:"祁同伟",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N4",text:"陈岩石",color:"#ec6941",borderColor:"#ff875e"},{id:"N5",text:"陆亦可",color:"#ec6941",borderColor:"#ff875e"},{id:"N6",text:"高育良",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N7",text:"沙瑞金",color:"#ec6941",borderColor:"#ff875e"},{id:"N8",text:"高小琴",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N9",text:"高小凤",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N10",text:"赵东来",color:"#ec6941",borderColor:"#ff875e"},{id:"N11",text:"程度",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N12",text:"吴惠芬",color:"#ec6941",borderColor:"#ff875e"},{id:"N13",text:"赵瑞龙",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N14",text:"赵立春",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N15",text:"陈海",color:"#ec6941",borderColor:"#ff875e"},{id:"N16",text:"梁璐",color:"#ec6941",borderColor:"#ff875e"},{id:"N17",text:"刘新建",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N18",text:"欧阳菁",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N19",text:"吴心怡",color:"#ec6941",borderColor:"#ff875e"},{id:"N20",text:"蔡成功",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"},{id:"N21",text:"丁义珍",color:"rgba(0, 206, 209, 1)",borderColor:"#6cc0ff"}],s=[{from:"N6",to:"N1",text:"师生",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N6",to:"N3",text:"师生",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N14",to:"N6",text:"前领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N14",to:"N13",text:"父子",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N14",to:"N17",text:"前部队下属",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N2",to:"N14",text:"前任秘书",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N3",to:"N8",text:"情人",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N4",to:"N15",text:"父子",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N5",to:"N15",text:"属下",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N7",to:"N4",text:"故人",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N3",to:"N15",text:"师哥",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N3",to:"N1",text:"师哥",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N1",to:"N15",text:"同学，生死朋友",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N6",to:"N12",text:"夫妻",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N15",to:"N10",text:"朋友",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N8",to:"N9",text:"双胞胎",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N10",to:"N5",text:"爱慕",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N3",to:"N11",text:"领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N6",to:"N9",text:"情人",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N13",to:"N3",text:"勾结",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N2",to:"N10",text:"领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N13",to:"N11",text:"领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N7",to:"N2",text:"领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N7",to:"N6",text:"领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N3",to:"N16",text:"夫妻",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N12",to:"N16",text:"朋友",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N2",to:"N18",text:"夫妻",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N13",to:"N17",text:"洗钱工具",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N13",to:"N8",text:"勾结，腐化",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N13",to:"N9",text:"腐化",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N19",to:"N5",text:"母女",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N19",to:"N12",text:"姐妹",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N20",to:"N1",text:"发小",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N20",to:"N18",text:"举报",color:"#ed724d",fontColor:"#ed724d"},{from:"N18",to:"N17",text:"举报",color:"#ed724d",fontColor:"#ed724d"},{from:"N17",to:"N13",text:"举报",color:"#ed724d",fontColor:"#ed724d"},{from:"N2",to:"N21",text:"领导",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N8",to:"N21",text:"策划出逃",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N3",to:"N21",text:"勾结",color:"#d2c0a5",fontColor:"#d2c0a5"},{from:"N13",to:"N21",text:"勾结",color:"#d2c0a5",fontColor:"#d2c0a5"}];new zd(e,{height:800,width:1300,level:2}).draw("N6",s,t)}document.querySelector("#app").innerHTML=`
  <div>
  <canvas id="canvas"></canvas>
  </div>
`;jd(document.querySelector("#canvas"));
